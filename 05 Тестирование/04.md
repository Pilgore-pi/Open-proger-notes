
<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" class="logo" width="120"/>
# Поясни, как нужно организовывать код. Какие методы нужно помещать в тестовый класс, что тестировать в методе.

Чтобы писать эффективные и поддерживаемые unit-тесты в C\#, особенно с xUnit, важно понимать, **как правильно организовать код тестов, какие методы помещать в тестовый класс и что именно тестировать**. Вот подробное руководство по этим вопросам.

## 1. Организация тестового класса

- **Тестовый класс обычно покрывает один тестируемый класс или функциональность.** Например, если у тебя есть класс `UserService`, создаётся класс тестов `UserServiceTests`.

- В тестовом классе размещай методы, каждый из которых проверяет отдельный аспект или поведение тестируемого класса.

- Имя тестового класса рекомендуется делать в формате:

```
<ИмяТестируемогоКласса>Tests
```

или

`<ИмяТестируемогоКласса>_Should` (например, `UserService_Should`), чтобы сразу понимать, что тестируется.

- Тестовые классы стоит группировать по функциональным блокам или папкам, повторяя структуру основного проекта.

## 2. Какие методы помещать в тестовый класс

- Каждый тестовый метод должен проверять **одно конкретное поведение или сценарий**.

- На уровне одного теста предпочтительно **один Assert** — чтобы при падении теста точно понимать, что именно сломалось.

- Названия тестов лучше писать так, чтобы по ним было понятно, что именно проверяется. Пример шаблона для названия метода:

```
MethodName_Scenario_ExpectedBehavior
```

Например:

```
IsPrime_InputIs1_ReturnsFalse
```

- Если нужно проверить много похожих случаев одного метода, используем **параметризованные тесты с атрибутами `[Theory]` + `[InlineData]`** (xUnit).

Это сокращает дублирование и упрощает поддержку.

- Метод теста должен быть аннотирован атрибутом `[Fact]` (один тест) или `[Theory]` (с параметрами).

## 3. Что именно тестировать в методе


- **Тесты должны проверять публичный контракт класса или метода.** Т.е. его публичные методы, ожидаемое поведение с разными типами входных данных, граничные случаи, исключения.

- Проверяем корректность результата (значения, состояний), а также побочные эффекты, если они есть (например, изменение состояния объекта, вызов внешних сервисов — в таких случаях стоит использовать Mock-объекты).

- Нужно покрывать как позитивные сценарии (корректные данные, правильный результат), так и негативные (ожидаемые ошибки, исключения).

- В тестах **не должно быть зависимости от внешних ресурсов** (базы данных, файловой системы, сети), если это не интеграционные тесты. Для изоляции используется mocking.

- Если метод зависит от сложной логики, её стоит разбить на несколько мелких тестируемых методов — тестировать их по отдельности.

- Выделять можно разные категории тестов: функциональные, структурные, производительные, но unit-тесты ориентированы на малые, быстрые проверки логики.


## 4. Пример структуры тестового класса


```csharp
public class CalculatorTests {
    
    [Fact]
    public void Add_TwoPositiveNumbers_ReturnsCorrectSum() {
        // Arrange
        var calculator = new Calculator();
        
        // Act
        int result = calculator.Add(3, 5);
        
        // Assert
        Assert.Equal(8, result);
    }
    
    
    
    [Theory]
    [InlineData(0, 0, 0)]
    [InlineData(-1, 1, 0)]
    [InlineData(100, 200, 300)]
    public void Add_VariousInputs_ReturnsExpectedSum(int a, int b, int expected) {
        var calculator = new Calculator();
        
        int result = calculator.Add(a, b);
        
        Assert.Equal(expected, result);
    }
    
    [Fact]
    public void Divide_ByZero_ThrowsArgumentException() {
        var calculator = new Calculator();
        Assert.Throws<ArgumentException>(() => calculator.Divide(10, 0));
    }
}

```

## 5. Хорошие практики

- **Каждый тест должен быть независим** — не должен полагаться на порядок запуска других тестов.

- Метод Arrange-Act-Assert — стандартный паттерн организации кода в тесте, его стоит придерживаться.

- Используй читабельные и понятные названия тестов.

- Не дублируй код — для общих данных используй конструктор класса тестов или методы инициализации `[TestInitialize]` (в MSTest) или конструктор (в xUnit).

- Для проверки исключений в xUnit используй `Assert.Throws` или `Assert.ThrowsAsync`.

- Покрывай как можно больше граничных, позитивных и негативных сценариев.

## Кратко

| Вопрос                         | Ответ                                                                                       |
| :----------------------------- | :------------------------------------------------------------------------------------------ |
| Что помещать в тестовый класс? | Методы тестирования конкретного класса/функциональности, каждый метод — отдельный сценарий. |
| Какие методы тестировать?      | Публичные методы класса: корректные входы, ошибки, исключения, граничные случаи.            |
| Как структурировать тесты?     | По поведению и сценариям с понятными названиями, использовать `[Fact]` и `[Theory]`.        |
| Сколько Assert в тесте?        | Желательно один, чтобы тест был максимально узко направлен.                                 |

Если хочешь, могу помочь с реальным примером для твоего конкретного кода или показать, как покрыть тестами один из методов, который ты написал. Просто дай знать!

<div style="text-align: center">⁂</div>
[^1]: https://habr.com/ru/companies/otus/articles/918942/
[^2]: https://metanit.com/sharp/aspnet5/22.2.php
[^3]: https://learn.microsoft.com/ru-ru/visualstudio/test/walkthrough-creating-and-running-unit-tests-for-managed-code?view=vs-2022
[^4]: https://learn.microsoft.com/ru-ru/dotnet/core/testing/unit-testing-csharp-with-xunit
[^5]: https://habr.com/ru/articles/859444/
[^6]: https://ru.stackoverflow.com/questions/934738/Как-правильно-создать-тест-с-помощью-xunit-и-что-тестировать
[^7]: https://www.youtube.com/watch?v=Jdbj6aSJpbY
[^8]: https://www.youtube.com/watch?v=ypNByfM0cHc
[^9]: https://meirz.net/2019/07/20/xunit-test-patterns-refactoring-test-code-шаблоны-тестирования-в-xunit-рефа/

#MERGE_NOTES #GENERATED #Testing #Testing/Unit_testing
