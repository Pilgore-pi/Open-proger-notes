
> **Финализатор** — это особый метод класса, который вызывается **автоматически средой выполнения (CLR) перед удалением объекта сборщиком мусора**. Финализатор позволяет выполнить заключительную очистку объекта, например, освободить неуправляемые ресурсы, если разработчик забыл сделать это вручную.

### Финализатор (Finalize) в C\#

- В C\# финализатор записывается в виде **деструктора** классa — метода с синтаксисом `~ИмяКласса()`. Например:

```csharp
class Person
{
    public string Name { get; }
    public Person(string name) => Name = name;
    
    ~Person()
    {
        Console.WriteLine($"{Name} deleted");
    }
}
```

- Хотя это называют деструктором, на самом деле C\# компилирует его в метод `Finalize()` — вызов этого метода происходит перед фактическим сбором объекта сборщиком мусора.
- В отличие от C++ десструкторов, **время вызова финализатора неопределено** и зависит от работы сборщика мусора; объект может прожить в памяти неопределённое время после того, как на него перестали ссылаться.
- Метод `Finalize` нельзя вызвать явно из кода, он вызывается автоматически средой выполнения.
- Обычно финализатор используется для освобождения **неуправляемых ресурсов** (например, файловых дескрипторов, сетевых сокетов), которые не покрываются сборщиком мусора.
- Если класс реализует финализатор, сборка такого объекта происходит медленнее, так как объект попадает в очередь финализации.

### Пример вызова финализаторов и порядок:

В иерархии наследования финализаторы вызываются в порядке от самого производного класса к базовому:

```csharp
class Base {
    ~Base() { Console.WriteLine("Base finalizer"); }
}

class Derived : Base {
    ~Derived() { Console.WriteLine("Derived finalizer"); }
}
```

При удалении `Derived` сначала вызовется финализатор `Derived`, затем `Base`.

### Метод `Initialize`

В .NET и C\# **стандартного метода `Initialize` нет как части языка или класса Object**. Обычно `Initialize` — это **пользовательский метод**, который программист пишет для инициализации объекта после его создания. Он не имеет специального значения в языке.

Пример:

```csharp
class MyClass {
    public int Value;

    public void Initialize(int val) {
        Value = val;
    }
}
```

Такой метод вызывается вручную после создания объекта, если нужно выполнить дополнительную инициализацию.

### Связь с паттерном IDisposable и освобождением ресурсов

- В C\# для правильного освобождения ресурсов используется интерфейс `IDisposable` с методом `Dispose()`, вызов которого контролирует разработчик (обычно через `using`).
- Это позволяет **освобождать ресурсы "здесь и сейчас"**, а не в неопределённом времени финализатором.
- Финализаторы обеспечивают "страховку", на случай если `Dispose` не был вызван, но их стоит избегать, так как они снижают производительность и усложняют работу сборщика мусора.

### Итог

| Метод / понятие | Что это | Особенности |
| :-- | :-- | :-- |
| **Финализатор / Finalize (деструктор `~Class()`)** | Специальный метод, вызываемый сборщиком мусора перед уничтожением объекта | Время вызова неопределено, используется для освобождения неуправляемых ресурсов, нельзя вызвать вручную |
| **Initialize** | Пользовательский метод инициализации объекта, не встроен в .NET | Используется для ручной инициализации, вызывается явным вызовом |
| **Dispose()** | Метод интерфейса `IDisposable` для явно управляемого освобождения ресурсов | Вызывается вручную или через `using`, предпочтительный способ управления ресурсами |

[^1]: https://pvs-studio.ru/ru/blog/posts/csharp/0437/
[^2]: https://ru.stackoverflow.com/questions/500438/Различие-dispose-finalize-Деструктора-и-класса-gc
[^3]: https://metanit.com/sharp/tutorial/8.2.php
[^4]: https://learn.microsoft.com/ru-ru/dotnet/csharp/programming-guide/classes-and-structs/finalizers
[^5]: https://ru.wikipedia.org/wiki/Финализатор
[^6]: https://habr.com/ru/companies/pvs-studio/articles/311998/
[^7]: https://professorweb.ru/my/csharp/charp_theory/level13/13_5.php
[^8]: http://plssite.ru/csharp/csharp_finalizers_article.html
[^9]: https://easyoffer.ru/question/5219
[^10]: https://ulearn.me/course/cs2/Finalizatory_2cc1bbed-3ed2-4b1f-abd9-0d0c1bf1fde2


#C-Sharp #Performance