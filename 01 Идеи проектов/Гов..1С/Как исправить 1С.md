
# Методы улучшения клиентского UI

## 01 Парсинг XML-выгрузки конфигурации

Можно выгружать конфигурацию в XML-файлы, которые затем можно обрабатывать с помощью любой программы. Приложение 1С предоставляет API для командной строки, который позволяет автоматизировать загрузку и выгрузку конфигурации.

**Преимущества:**

- Независимость от IDE
- Можно использовать любой язык программирования и любую ОС
- Можно автоматически обновлять конфигурацию и по расписанию
- Большая гибкость по функционалу и способам обработки, так как можно использовать любое ПО
- Появляется возможность наработки собственных элементов управления, которые затем можно будет просто вставлять в XML. Это позволяет соблюдать паттерн **DRY** (Don't repeat yourself)
- Появляется возможность применения различных паттернов проектирования приложения в целом

**Недостатки:**

- Необходимость анализировать XML-структуры объектов и их свойства, что увеличивает сложность
- Редактирование конфигурации неинтерактивное. Требуется перезапуск конфигуратора
- Требуется разработка парсера и генератора XML-объектов 1С, а также приемливого UI
- Ограниченные возможности по разработке форм с зависимостями
- Разработка XML-анализатора потребует значительного времени

## 02 Использование HTML-документов

В 1С используется интегрированный веб-браузер WebKit

**Преимущества:**

- Возможности UI теперь ограничиваются только возможностями HTML, CSS и JS
- Легкая разработка UI и логики
- Язык обработки UI — JavaScript
- Можно без проблем использовать код 1С для бэкенда
- Можно использовать JS для обработки данных через преобразования в/из JSON

**Недостатки:**

- Необходимо тестировать отображение HTML документа при разном размере экрана и в разных браузерах
- Необходимо владеть знаниями HTML, CSS, JS

```bsl
&НаКлиенте
Процедура Тест(Команда)
	Макет = ПолучитьМакет("Макет");
	Данные = Макет.ПолучитьТекст();
	
	Скрипт = "
	|	const last = arr1.pop()
	|	const first = arr1.shift()
	|	arr1.splice(5,20)
	|	arr1.reverse()
	|	document.getElementById('body').innerHTML=JSON.stringify(arr1)
	|";
	
	HTML = "<!DOCTYPE html>
	|<html>
	|<head></head>
	|<body id='body'>
	|<script>
	|	arr1 = "+Данные+"
	|   "+Скрипт+"
	|</script>
	|</body>
	|</html>";
	ПодключитьОбработчикОжидания("ПолучитьРезультат", 0.1, истина);
	
КонецПроцедуры

Функция ПолучитьМакет(Макет)
	Обработка = РеквизитФормыВЗначение("Объект");
	Возврат Обработка.ПолучитьМакет(Макет); 
КонецФункции

&НаКлиенте
Процедура ПолучитьРезультат()
	
	Попытка
		HTMLBody = Элементы.HTML.Документ.body.textContent;
		Стр = ИзJSON(HTMLBody);
		ТутЯСтавлюТочкуОстанова = 1;
	Исключение
		Сообщить(ОписаниеОшибки());
		
        //Если ошибка, то подключаю ОЖ еще раз через 1 секунду
		ПодключитьОбработчикОжидания("ПолучитьРезультат", 1, истина);
	КонецПопытки;	
	
КонецПроцедуры

Функция ИзJSON(СтрокаJSON) 
	ТекТоварыJSON = Новый ЧтениеJSON;
	ТекТоварыJSON.УстановитьСтроку(СтрокаJSON);
	Возврат ПрочитатьJSON(ТекТоварыJSON);
КонецФункции
```

## 03 [Использование SVG](https://infostart.ru/1c/articles/1536215/)

Вместо кнопок используются элементы "Поле картинки" со свойством Путь к данным, привязанным к строке, хранящей XML код SVG файла.

**Преимущества:**

- Позволяет делать кастомные масштабируемые кнопки и другие элементы управления

**Недостатки:**

- Ограниченные возможности. Данный подход является небольшим решением по улучшению GUI, но он не предоставляет серьезных инструментов

## 04 Ожидание платформы 1С 8.5

В конце декабря 2024 года была анонсирована новая версия платформы с современным интерфейсом

Версия 8.5.1 соответствует версии 8.4.27 в плане внутренней архитектуры

Тестовая база доступна в браузерном варианте по [ссылке](https://v8.1c.ru/platforma/new-ui-85/)

**Преимущества:**

- Наиболее естественный способ улучшения GUI
- Ничего разрабатывать не нужно

**Недостатки:**

- Возможно придется перерабатывать существующие формы
- Возможно будут проблемы с производительностью, так как в демо-версии очень не отзывчивый интерфейс


## 05 Использование готовых решений

На платформе 1С уже были разработаны полезные средства разработки и администрирования приложения, такие как:

- Консоль кода 1С
- Консоль запросов
- Консоль СКД
- Сравнение объектов
- Управление реквизитами
- Редакторы кода различных языков программирования
- Конвертация данных
- Синхронизация данных

Примеры проектов:

- [PowerTools](https://infostart.ru/marketplace/167865/): Работа с конфигурацией и администрирование в режиме клиента
- 

**Преимущества:**

- Ничего разрабатывать не нужно
- Огромное число полезных инструментов для разработки и администрирования
- 

**Недостатки:**

- Самые полезные разработки стоят денег
- Обычно, обновление и поддержка также стоят денег

## 06 Использование стандартных средств 1С

**Преимущества:**

- Знакомый и понятный подход
- Наиболее простой и быстрый способ разработки несложных форм

**Недостатки:**

- **НЕ решает проблему ужасного UI**
- Очень трудно создавать сложные и динамически изменяемые формы
- Множество ограничений UI
- Паттерн разработки форм существует только 1, грубо говоря
- Если функционал форм повторяется, приходится дублировать его, выполняя копирование

## 07 Программное управление формами

Существует API для создания, удаления и редактирования элементов управления формы. Однако формы 1С идеологически не предназначены для такого обращения, поэтому доступные средства 1С очень ограничены в этом плане

**Преимущества:**

- Данный подход открывает возможность динамического добавления, удаления и изменения элементов форм

**Недостатки:**

- Приходиться писать очень сложный код
- Такой код тяжело поддерживать
- Время разработки форм с таким подходом возрастает на порядок

## 08 Отказ от конфигурации 1С

Обращаясь к базе данных 1С напрямую можно создать свой GUI на любом фреймворке (Avalonia, Kotlin Multiplatform, Electron JS, QT, ...). Конфигурацию можно обрабатывать также с помощью других технологий. Хотя, можно вообще

**Преимущества:**

- Никаких ограничений UI
- Возможность использования любых паттернов проектирования
- Использование любых доступных инструментов разработки

**Недостатки:**

- Все придется писать с нуля
- Большая трудоемкость и время-затраты
- Требуется хорошее понимание структуры конфигурации и API 1С
- Требуется понимание работы SQL сервера 1С и механизмы работы с ним
- Команда разработки может не обладать навыками программирования с применением других технологий (не 1С)

# Методы улучшения IDE

Стандартный конфигуратор крайне устарел и имеет множество функциональных и визуальных багов. Существует несколько вариантов замены конфигуратора

## 01 Бесплатная IDE 1С:EDT

1С:EDT разработан на основе IDE Eclipse

[С конфигуратора на EDT](https://infostart.ru/1c/articles/1516894/)

**Преимущества:**

- IDE бесплатная
- Система плагинов позволяет устанавливать готовые плагины или разрабатывать свои на языке Java
- Встроенная поддержка Git
- Возможность менять используемую версию платформы и базу данных для одной и той же конфигурации
- Возможность работы на несколькими конфигурациями в одном окне IDE
- Встроенный анализатор кода
- База данных не привязана к конфигурации
- Улучшенный анализатор зависимостей объектов метаданных
- Улучшенный менеджер объединения конфигураций

**Недостатки:**

- В 1С:EDT обновления платформы выходят с задержкой в примерно 2-3 версии (8.25 в EDT и 8.27 в конфигураторе)
- Требует установки Java
- Низкая производительность IDE
- Интерфейс, хоть и лучше, чем в конфигураторе, но все еще является устаревшим
- Не поддерживает обычные формы

## 02 Управление конфигурацией через VS Code & OneScript

**Преимущества:**

- Большая совместимость кода встроенного языка и кода на OneScript
- OneScript поддерживает ООП
- VS Code — современный редактор кода с многочисленными расширениями, анализаторами и инструментами рефакторинга
- VS Code позволяет использовать нейросети, типа Copilot
- OneScript позволяет подключать библиотеки, разработанные сообществом языка. Разработано несколько очень мощных библиотек, которые позволяют использовать Git, обновлять конфигурацию во время ее использования и т. д.
- OneScript совершенно независим от платформы 1С
- Код OneScript пишется на русском, что делает этот язык дружелюбным для 1С-ников

**Недостатки:**

- Можно использовать более богатые по функционалу языки программирования, такие как Python, C#
- Русский язык: в среднем слова длиннее и, иногда, приходится в рамках одного идентификатора использовать и кириллицу и латинницу

## 03 Разработка собственных инструментов

Разработка собственной IDE для разработки конфигураций и поддержки существующих. IDE должна обращаться к серверу 1С и SQL базе данных напрямую через предоставленный API

**Преимущества:**

- Полная кастомизация
- Независимость от используемых технологий
- Возможность добавления самых современных инструментов разработки 

**Недостатки:**

- Все придется писать с нуля
- Большая трудоемкость и время-затраты
- Требуется хорошее понимание структуры конфигурации и API 1С
- Требуется понимание работы SQL сервера 1С и механизмы работы с ним

## 04 Разработка внешних инструментов

К примеру в окне конфигуратора можно использовать Copilot, выполнив некоторые манипуляции.
К примеру можно выделить блок кода в каком-то модуле, скопировать его, чтобы текст попал в буфер обмена, затем нажать специальную комбинацию клавиш, которая выполнит скрипт, который делает запрос через Copilot API и получает ответ, который вставляется в буфер обмена. После этого можно просто нажать Ctrl+V, чтобы вставить ответ.

#AutoHotkey

Таким образом можно разработать или подсоединить существующие анализаторы кода, чтобы в комментариях, например, писать предупреждения и ошибки.

Можно, вообще, нажатием одной комбинации клавиш выполнить скрипт. Пример алгоритма скрипта:

1. Эмулирование нажатия: `Ctrl + A`
2. Эмулирование нажатия: `Ctrl + C`
3. Выполнить анализ кода из буфера обмена
4. Добавление в код замечаний
5. Добавление измененного текста в буфер обмена
6. Эмулирование нажатия: `Ctrl + V`

**Преимущества:**

- Не требуется слишком много времени на разработку, по сравнению с созданием собственной IDE
- Подход совершенно не зависит от используемой IDE и редакторов кода
- Возможна реализация любых алгоритмов анализа текста

**Недостатки:**

- Полная обособленность от конфигуратора уменьшает удобство разработки

# Методы интеграции сторонних технологий

## 01 Интеграция через внешнюю компоненту

1С поддерживает подключение динамических библиотек (DLL) через объект `ВнешняяКомпонента`, что позволяет написать DLL на любом языке программирования и использовать внутри 1С. Например, в 1С нет задержки выполнения потока. Создав простейший скрипт на C++ (`Thread.Sleep()`), можно привнести эту функциональность

Где должна храниться динамическая библиотека?

- На сервере, если код выполняется на сервере
- На компьютере каждого пользователя, если код выполняется на клиенте
- Внутри приложения 1С. Такой подход позволяет использовать код как на сервере, так и на клиенте, но может значительно влиять на производительность из-за генерации файлов на диске

**Преимущества:**

- Независимость от внешних технологий. Вся функциональность представлена внутри DLL файла
- Использование библиотеки не требует знаний используемых в ней технологий
- Не требуется подключение к Интернету

**Недостатки:**

- DLL библиотека может много весить
- Чтобы обновить библиотеку, необходимы знания используемой в ней технологий и исходных файлов для сборки новой версии
- Сторонняя DLL может стать источником угроз, если автор библиотеки неизвестен или автор не применял необходимых методов защиты

## 02 Сетевое взаимодействие

Через HTTP и Web сервисы по одному из протоколов можно обращаться к независимому приложению и любому доступному API как локально, так и из Интернета.

**Преимущества:**

- Использование общемирового стандарта передачи данных
- Данный подход может использоваться в рамках одного компьютера, локальной сети или глобальной сети
- HTTP запросы достаточно быстры
- Возможно использование сертификатов SSL и др. для защиты данных

**Недостатки:**

- HTTP и Web сервисы тяжело настраивать


## 03 Взаимодействие через COM-интерфейс

В большинстве современных языков есть возможность использования COM технологии, позволяющей взаимодействовать приложениям между собой.

**Преимущества:**

- Не требуется подключение к Интернету
- Позволяет довольно просто взаимодействовать со многими продуктами Microsoft, такими как Word, Excel, PowerPoint, Paint, Блокнот, DirectX...
- Простая разработка COM приложений на Visual Basic
- Такие технологии как ActiveX, OLE и части экосистемы .NET построены на COM

**Недостатки:**

- Весьма сложно настраивать. В стороннем приложении нужно создать необходимые COM классы и интерфейсы, а затем зарегестрировать COM-приложение в реестре
- Технология доступна только на Windows
- Технология устарела
- В интернете мало информации по данной технологии
- Существует версия DCOM, позволяющая обмениваться данными через интернет, однако она не используется, так как есть HTTP/GRPC
- При некоторых обстоятельствах COM-соединение между базой 1С и COM-приложением может нарушить работу приложения (зависание)
- При разработке COM приложения необходимо вручную контролировать счетчик ссылок, что может привести к проблемам с памятью
- При обмене данными могут возникать проблемы с производительностью
- Не все языки программирования обладают хорошей поддержкой технологии COM, что сужает выбор используемого языка для разработки внешнего приложения

# Полезные ссылки

- Интеграция с 1С через [PowerShell](https://infostart.ru/1c/articles/1148862/)
- Использование [JavaScript](https://infostart.ru/1c/articles/1355214/) для обработки данных в 1C


#1С #Идеи_проектов
