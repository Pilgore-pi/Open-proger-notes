## Наследование моделей БД

<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

#### Можно ли в POCO-классах, моделях БД использовать механизм наследования, не нарушает ли это работу ORM?

Да, в POCO-классах для моделей базы данных в Entity Framework Core можно использовать механизм наследования, и это не нарушит работу ORM, если применить корректное сопоставление.

***

### Особенности наследования в EF Core

Entity Framework Core поддерживает три основных стратегии наследования для сопоставления иерархий классов с таблицами базы данных:

1. **Table-per-Hierarchy (TPH)** — все классы иерархии хранятся в одной таблице с дополнительным столбцом, указывающим конкретный тип. Это стратегия по умолчанию и самая простая.
2. **Table-per-Type (TPT)** — каждый класс в иерархии (базовый и наследники) сопоставляется со своей таблицей, наследники содержат только специфичные столбцы и связаны с таблицей базового класса ключом.
3. **Table-per-Concrete-type (TPC)** — для каждого класса создается отдельная таблица со всеми столбцами, включая унаследованные. Т.к. данных о базовом классе как отдельной таблице нет, при запросах к базовому классу выполняются объединения.

***

### Как использовать наследование в моделях

Пример TPH — самое распространенное:

```csharp
public abstract class Person {
    public int Id { get; set; }
    public string Name { get; set; }
}

public class Employee : Person {
    public decimal Salary { get; set; }
}

public class Customer : Person {
    public string Address { get; set; }
}
```

EF Core по умолчанию сохранит все в одну таблицу `People` с колонкой `Discriminator`.

***

### Настройка наследования через Fluent API

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder) {
    modelBuilder.Entity<Person>()
        .HasDiscriminator<string>("Discriminator")
        .HasValue<Employee>("Employee")
        .HasValue<Customer>("Customer");
}
```

Для TPT или TPC обычно требуется дополнительно настраивать, в первую очередь при сложных сценариях.

***

### Важные моменты

- Наследование в моделях позволяет использовать объектно-ориентированные преимущества без потери возможности работы с реляционной БД.
- EF Core отлично поддерживает наследование, нужно лишь правильно выбрать стратегию под задачу.
- Стандартный вариант TPH — наиболее простой и производительный, особенно на старте.
- Если используется SQLite, стоит учитывать, что TPT поддерживается с EF Core 5+, а TPC — с EF Core 7+ с некоторыми ограничениями.

***

### Вывод

Механизм наследования в POCO моделях полностью поддерживается EF Core и не нарушает его работу при правильной настройке моделей и контекста.
<span style="display:none">[^1][^2][^3][^4][^5][^6][^7][^8]</span>

<div style="text-align: center">⁂</div>

[^1]: https://itvdn.com/ru/video/ef-core-essential/imitation-in-models
[^2]: https://learn.microsoft.com/ru-ru/ef/ef6/modeling/code-first/fluent/types-and-properties
[^3]: https://learn.microsoft.com/ru-ru/ef/core/modeling/inheritance
[^4]: https://stackoverflow.com/questions/75218410/creating-poco-classes-for-complex-relationship-scenario-in-ef-core-7
[^5]: https://andrey.moveax.ru/post/mvc3-in-depth-entity-framework-02-working-with-entity-framework
[^6]: https://stackoverflow.com/questions/10295783/poco-inheritance-in-entity-framework
[^7]: https://www.reddit.com/r/dotnet/comments/1gsc0iv/ef_core_model_creating_types_with_inheritance/?tl=ru
[^8]: https://habr.com/ru/articles/47395/


#MERGE_NOTES
