
## Механизмы управления памятью в современных компьютерах

Существует несколько видов памяти. Ниже перечислены ее виды от самой маленькой и быстрой до самой большой и медленной.

1) Регистры процессора – память, представляющая собой набор маленьких ячеек памяти.
2) Кэш-память – хранилище для часто используемых процессором памяти. Кэш подразделяется на несколько уровней (L1, L2, L3)
3) Оперативная память – скорость около 15-30 Гб/с
4) Постоянная память – скорость около 250-500 Мб/с

> **Минимальная единица адресации памяти – это 1 байт**

Процессор не может индивидуально обращаться к конкретному биту в памяти

В различных компьютерах адресация ячеек происходит по-разному. Это либо байтовая адресация, либо адресация сразу машинного слова – максимального количества бит, которое процессор может обработать за раз для 32-х разрядных систем – это 32-битное слово, для 64-разрядных – 64-битное.

Для работы с текстом байтовая адресация гораздо выгоднее по скорости, чем словесная. Словесная адресация лучше работает с числами.

Значимые типы при присваивании копируют получаемое значение, а ссылочные при присваивании будут указывать на ту переменную, которая была присвоена ссылочной переменной.

Все данные в C# представляют собой объекты. Объекты с сохранением структуры могут размещаться только в оперативной памяти

### Стек и куча

> Оперативная память логически разделена на **Heap (кучу)** и **Stack (стек)**.

> **Стек** — статическая область оперативной памяти, отведенная для хранения временных данных и вызова функций. Стек реализован по принципу *LIFO(Last in First out)*. Стековая память работает быстро из-за строгой организации памяти: память заполняется последовательно, переменные идут друг за другом.

> **Куча** — динамическая область оперативной памяти, в которой находятся все программы, в том числе и операционная система. Куча работает по принципу *FIFO(First in First out)*. Куча больше стека и и позволяет хранить данные в произвольном порядке, из-за чего куча работает медленней стека

**Различия Кучи и стека:**

| Стек                                                                                                                   | Куча                                                                                                                               |
| ---------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| Маленький размер                                                                                                       | Большой размер                                                                                                                     |
| Высокая скорость                                                                                                       | Скорость ниже                                                                                                                      |
| Данные располагаются последовательно                                                                                   | Расположение данных не имеет конкретной структуры                                                                                  |
| Размер стека — фиксированная величина                                                                                  | Размер кучи — вся оперативная память, кроме стека                                                                                  |
| Данные располагаются в сторону уменьшения адресов (от конца к началу)                                                  | Данные располагаются в сторону увеличения адресов (от начала к концу)                                                              |
| Процессор управляет памятью в стеке и автоматически занимается сборкой мусора                                          | Процессор не контролирует память в куче. Очисткой памяти должен заниматься программист (C/C++) или сборщик мусора (C#, JavaScript) |
| Стек содержит только локальные переменные                                                                              | Куча может содержать любые переменные                                                                                              |
| Обращение к стеку возможно только в рамках соответствующего потока (поэтому стек содержит только локальные переменные) |                                                                                                                                    |
| Объекты структур по умолчанию располагаются на стеке                                                                   | Объекты классов по умолчанию располагаются в куче                                                                                  |
| Обращение к памяти происходит непосредственно через адреса                                                             | Взаимодействие с кучей осуществляется с помощью ссылок и указателей                                                                |

#Memory #Dotnet