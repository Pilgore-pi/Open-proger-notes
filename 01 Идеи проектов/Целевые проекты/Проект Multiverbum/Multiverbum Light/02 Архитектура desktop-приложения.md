Назад: [[01 Проектирование|Проектирование]]

> Шаблон проектирования: MVVM

Здесь описывается структура проекта десктопной версии приложения и все специфичные для этой версии особенности

## Состав решения

#### Multiverbum.Client.csproj

##### ASSETS

- Icons
- Sounds (memes)

##### MODELS

- `OrmMappingTypes` — таблицы БД, описанные на C#
- `DbInterface` — логика подключения к БД (локальной и серверной), предоставление интерфейса взаимодействия с таблицами БД
    - `Creation operations`
    - `Editing operations`
    - `Deleting operations`
    - `Fetching operations`
    - Необходимые виртуальные таблицы
- `ServerApi` — интерфейс сервера, предоставляющий доступ к удаленной БД или к локальной, в таком случае, сервер и клиент будут одним и тем же понятием. Модуль должен использоваться классом `DbInterface`

##### VIEW MODELS

— выполняют обслуживание интерфейса, взаимодействуя с БД как с черным ящиком через `DbInterface`

##### VIEWS

- `MainPage`
- `EditingPage`
- `UsingPage`
- `UserSummaryPage`
- `TestSummaryPage`
- ?`TreeViewer` — служебный элемент управления (древовидный просмотр таблиц)
- ?`TableViewer` [guide 1](https://docs.avaloniaui.net/docs/reference/controls/treeview-1) [gitgub perfect control](https://github.com/AvaloniaUI/Avalonia.Controls.TreeDataGrid) — служебный ЭУ

##### БАЗА ДАННЫХ

Файл базы данных, хранящийся локально на компьютере

#### Multiverbum.Tests.csproj

- Проверка сортировки вопросов по приоритетам
- Проверка создания новой записи в БД
- Проверка редактирования записи
- Проверка удаления записи
- Проверка получения записи?

## План реализации решения

#### 1 Разработка базы данных

###### 1.0 Подключить Entity Framework Core и доп. зависимости при необходимости

###### 1.1 Создать файл с определением классов, сопоставляемых с таблицами БД (модели ORM)

###### 1.2 Реализовать контекст базы данных (DbContext) с использованием определенных сопоставляемых классов и обработать необходимые события

###### 1.3 Создать интерфейс-оболочку над DbContext и ServerAPI,
который будет предоставлять инкапсулированный доступ к таблицам БД. При этом, фактически, обращение к таблице может происходить как в локальной БД (без авторизации пользователя), так и в удаленной БД на сервере. Клиент приложения не должен знать о реализации интерфейса БД

Класс `DbInterface` должен:

- инкапсулировать CRUD-операции
- хешировать входящие значения паролей

###### 1.4 Генерация миграций

Создание БД происходит через выполнение автогенерируемого кода.

1.4.1 Открыть консоль менеджера пакетов
1.4.2 Выполнить команду `Add-Migration InitialCreate`:
1.4.3 Проверить наличие папки "Migrations", которая должна была создасться после выполнения команды
1.4.4 Запустить миграцию, выполнив команду `Update-Database`

#### 2 Разработка UI

##### 2.1 MainPage

###### 2.1.1 Строка поиска

При вводе текста по каждой ячейке происходит поиск по частичному совпадению. Происходит фильтрация

###### 2.1.2 [TreeDataGrid](https://docs.avaloniaui.net/docs/reference/controls/treedatagrid/) (Древовидная таблица с тестами, сгруппированными по темам)

###### 2.1.3 Кнопка создания теста

Переход на `EditingPage`

###### Круглый дефолтный аватар в правом верхнем углу

Переход на `UserSummaryPage`

##### 2.2 EditingPage

- General data + user related info
- Коллекция элементов SectionView

##### 2.3 UsingPage

- Текст задания
- Опционально варианты ответа
- Поле ввода свободного ответа

##### 2.4 UserSummaryPage

- Общая инфа
- Суммарные показатели
- Список пройденных тестов (с фильтрами и поиском) (то же, что и в main page)

##### 2.5 TestSummaryPage

Простая таблица с результатами по тесту

Тест: Название теста

| Вопрос | Текст вопроса | Баллов получено         | Макс. баллов |
| ------ | ------------- | ----------------------- | ------------ |
| 1      | Текст вопроса |                         |              |
| 2      | ...           |                         |              |
| ...    |               |                         |              |
| N      | ...           | ...                     | ...          |
| Всего: |               | SUM (X % прав. ответов) | SUM          |

Лучше, чем в прошлый раз!
*или*
Хуже, чем в прошлый раз
*или*
Примерно также, как и в прошлый раз

##### 2.6 SectionView

`TreeDataGrid` с

- текстом вопроса,
- CheckBox Разрешить ввод свободного ответа,
- набором вариантов ответов,
- правильными ответами,
- полуправильными ответами

- Кнопки: удалить, создать копию, Переместить вверх, Переместить вниз

##### 2.7 \[SignInPage\]

- Поле ввода логина
- Поле ввода пароля
- Кнопка Войти
- Кнопка Зарегестрироваться
- Кнопка Продолжить без аккаунта

Sign in активируется, если user нажал на аватар и при этом не был авторизован

##### 2.8 \[SignUpPage\]

- Поле ввода логина
- Поле ввода пароля
- Поле ввода пароля еще раз
- Кнопка Отмена
- Кнопка Зарегестрироваться
- Кнопка Продолжить без аккаунта

#### 3 Разработка View Model

#### 4 Локализация (словари ресурсов)

#### 5 Тестирование

###### 5.1 Написание и запуск Unit-тестов
###### 5.2 Ручное тестирование UI

#Идеи_проектов/Multiverbum