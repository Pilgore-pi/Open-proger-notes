
Исключение — это непредвиденная ситуация, возникающая при ошибке выполнения программы. Ошибки могут возникать на 2 этапах:

- на этапе компиляции программы (compile time)
- на этапе выполнения программы (run time)

| Оператор    | Описание                                                                                                                              |
| :---------- | :------------------------------------------------------------------------------------------------------------------------------------ |
| **try**     | блок, внутри которого записывается код, потенциально вызывающий исключение                                                            |
| **catch**   | блок, перехватывающий и обрабатывающий исключения заданных типов                                                                      |
| **finally** | блок, который выполняется всегда после try/catch, независимо от того, было исключение или нет. Используется для освобождения ресурсов |
| **throw**   | оператор создания и "выбрасывания" исключения                                                                                         |

## Как работает обработка исключений

1. Код в блоке `try` пытается выполниться
2. Если внутри `try` возникает исключение (создается с помощью `throw` или автоматически CLR), выполнение блока прерывается
3. CLR проходит стек вызовов вверх и ищет первый подходящий `catch`, который может обработать исключение выбранного типа
4. Если `catch` найден, управление передается в него — там можно обработать ошибку
5. Если подходящего `catch` не найдено, программа аварийно завершается
6. После `try` и `catch` выполняется блок `finally` (если он есть)

```cs
try {
    
    // Код, который может вызвать исключение
    
} catch (SpecificExceptionType ex) {
    
    // Обработка конкретного типа исключения
    
} catch (Exception ex) {
    
    // Обработка всех остальных исключений
    
} finally {
    
    // Код, который выполнится в любом случае (например, освобождение ресурсов)
}
```

Пример простой обработки исключения

```cs
try {
    int a = 10;
    int b = 0;
    int c = a / b; // вызвать исключение DivideByZeroException
} catch (DivideByZeroException) {
    Console.WriteLine("Деление на ноль недопустимо");
} finally {
    Console.WriteLine("Этот блок выполнится всегда");
}
```

Можно создавать собственные классы исключений, наследуя от `Exception`:

```cs
public class MyCustomException : Exception {
    public MyCustomException(string message) : base(message) { }
}
```

> Важно перехватывать исключения **от более специфичных к более общим**, чтобы правильно обработать каждое из них

```cs
try {
    // Код
}
catch (ArgumentNullException ex) {
    Console.WriteLine("Пустой аргумент");
}
catch (ArgumentException ex) {
    Console.WriteLine("Некорректный аргумент");
}
catch (Exception ex) {
    Console.WriteLine("Общее исключение");
}
```

Ловить исключения необязательно при обработке ошибок:

```cs
try
{
    // Код
}
finally
{
    // Выполнится всегда
}
```

```cs
try
{
    // код
}
catch (Exception ex)
{
    // обработка или логирование
    throw; // повторный выброс существующего исключения
}

```

## Лучшие практики при работе с исключениями

- Перехватывайте только те исключения, которые можете обработать.
    
- Не заглушайте исключения без логирования.
    
- Избегайте использования исключений для управления потоком программы.
    
- Используйте стандартные типы исключений, если подходят.
    
- Пользуйтесь конструкцией `using` для автоматического освобождения ресурсов, где это возможно (альтернатива finally).
    
- В catch-блоках указывайте как можно более конкретные типы исключений.

## Тип Exception

| Конструктор                                    | Описание                                                                           |
| ---------------------------------------------- | ---------------------------------------------------------------------------------- |
| `Exception()`                                  |                                                                                    |
| `Exception(string message)`                    | При создании задает сообщение об ошибке                                            |
| `Exception(string message, Exception innerEx)` | Дополнительно задает ссылку на внутреннее исключение, вызвавшее текущее исключение |

| Свойство     | Тип       | Описание                                                  |
| ------------ | --------- | --------------------------------------------------------- |
| `Source`     | `string?` | Имя приложения или объекта, вызвавшего исключение         |
| `Message`    | `string`  | Сообщение об ошибке                                       |
| `StackTrace` | `string`  | Строка, описывающая стек вызовов при возникновении ошибки |
| ``           | ``        |                                                           |
| ``           | ``        |                                                           |
| ``           | ``        |                                                           |
| ``           | ``        |                                                           |
| ``           | ``        |                                                           |



 #Dotnet #C-Sharp