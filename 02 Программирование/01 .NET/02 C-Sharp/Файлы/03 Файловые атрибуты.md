
> Атрибуты файлов и каталогов — это специальные метаданные, которые характеризуют свойства файловой системы

Существуют следующие атрибуты

| Атрибут             | Символ | Позиция в `enum` | Описание                                                                                                                                                                                                                                                                                            | Поддержка ОС                                            |
| :------------------ | :----- | :--------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------ |
| `None`              | (нет)  | 0                | Отсутствие значения (используется только в коде программы)                                                                                                                                                                                                                                          | —                                                       |
| `ReadOnly`          | `R`    | 1                | **Только для чтения** — запрещает изменение содержимого файла                                                                                                                                                                                                                                       | Windows, Linux, macOS                                   |
| `Hidden`            | `H`    | 2                | **Скрытый** — файл или каталог скрыт от стандартного отображения (например, в Проводнике Windows)                                                                                                                                                                                                   | Windows, Linux (по имени файла), macOS (по имени файла) |
| `System`            | `S`    | 4                | **Системный** — файл или каталог считается важным для ОС, обычно скрыт от пользователя                                                                                                                                                                                                              | Windows                                                 |
| `Directory`         | (нет)  | 16               | **Каталог** (папка) — отличает каталоги от файлов. Не имеет обозначения буквой в `attrib`                                                                                                                                                                                                           | Windows, Linux, macOS                                   |
| `Archive`           | `A`    | 32               | **Архивный** — указывает, что файл был изменён с момента последнего резервного копирования. Используется резервными системами                                                                                                                                                                       | Windows                                                 |
| `Device`            | (нет)  | 64               | Зарезервировано для будущего использования                                                                                                                                                                                                                                                          | Windows                                                 |
| `Normal`            | (нет)  | 128              | **Обычный файл** без специальных атрибутов. *Этот атрибут действителен, только если он используется отдельно*                                                                                                                                                                                       | Windows, Linux, macOS                                   |
| `Temporary`         | (нет)  | 256              | **Временный файл**, предполагается быстрое удаление                                                                                                                                                                                                                                                 | Windows                                                 |
| `SparceFile`        | (нет)  | 512              | Файл является разреженным. Разреженными файлами обычно являются большие файлы, в которых содержатся в основном нулевые данные                                                                                                                                                                       | Windows, ?                                              |
| `ReparsePoint`      | (нет)  | 1024             | Файл содержит **точку повторной обработки**, блокирующую определяемые пользователем данные, связанные с файлом или каталогом                                                                                                                                                                        | Windows; частично в Linux/macOS (символьные ссылки)     |
| `Compressed`        | (нет)  | 2048             | **Сжатый файл** ФС `NTFS`                                                                                                                                                                                                                                                                           | Windows                                                 |
| `Offline`           | (нет)  | 4096             | Файл находится в **автономном режиме**. Данные этого файла недоступны непосредственно                                                                                                                                                                                                               | Windows                                                 |
| `NotContentIndexed` | `I`    | 8192             | Файл **не будет индексироваться** службой индексирования содержимого операционной системы                                                                                                                                                                                                           | Windows                                                 |
| `Encrypted`         | (нет)  | 16384            | **Файл или каталог зашифрован**. Для файла это означает, что все данные в файле зашифрованы. Для каталога это означает, что шифрование производится по умолчанию для вновь создаваемых файлов и каталогов                                                                                           | Windows                                                 |
| `IntegrityStream`   | (нет)  | 32768            | Файл или каталог включает поддержку **целостности данных**. Когда это значение применяется к файлу, все потоки данных в этом файле имеют поддержку целостности. Когда это значение применяется к каталогу, все новые файлы и подкаталоги этого каталога по умолчанию включают поддержку целостности | Windows                                                 |
| `NoScrubData`       | (нет)  | 131072           | Файл или каталог исключен из проверки целостности данных. Когда это значение применяется к каталогу, по умолчанию для всех новых файлов и подкаталогов этого каталога поддержка целостности исключается                                                                                             | Windows                                                 |


> Буквы `R`, `H`, `S`, `A`, `I` — традиционные сокращённые обозначения в Windows, отражаемые командой `attrib` и в свойствах файла.


## Работа с файловыми атрибутами

Для манипуляций с атрибутами используется класс `System.IO.File` (для файлов) и `System.IO.Directory` (для каталогов), а также базовый класс `FileSystemInfo` (свойства у `FileInfo` и `DirectoryInfo`).

- **Получение атрибутов:**

```csharp
var attributes = File.GetAttributes("path_to_file_or_directory");
```

- **Установка атрибутов:**

```csharp
File.SetAttributes("path_to_file_or_directory", attributes | FileAttributes.Hidden);
// Добавляем атрибут Hidden (скрытый)
```

- **Удаление атрибута:**

```csharp
File.SetAttributes("path_to_file_or_directory", attributes & ~FileAttributes.ReadOnly);
// Убираем атрибут ReadOnly (только для чтения)
```

- **Пример проверки атрибутов:**

```csharp
FileAttributes attributes = File.GetAttributes("c:/Temp/testfile.txt");

if ((attributes & FileAttributes.ReadOnly) == FileAttributes.ReadOnly)
    Console.WriteLine("Файл доступен только для чтения");
else
    Console.WriteLine("Файл доступен для записи");
```


### Описание основных атрибутов (перечисление `FileAttributes`)

| Атрибут | Назначение |
| :-- | :-- |
| `ReadOnly` (1) | Файл/каталог доступен только для чтения. |
| `Hidden` (2) | Файл или каталог скрыт в стандартных списках. |
| `System` (4) | Системный файл/каталог. |
| `Directory` (16) | Объект является каталогом (используется для различения файлов и папок). |
| `Archive` (32) | Файл помечен для резервного копирования. Windows ставит этот флаг при изменении файла. |
| `Temporary` (256) | Временный файл, предполагается удаление после использования. |
| `Compressed` (2048) | Файл сжат. |
| `Encrypted` (16384) | Файл или каталог зашифрован. |

> Полный список доступен в перечислении `FileAttributes` MSDN[^3]

- Атрибуты хранятся в битовом флаге: для добавления атрибута используют побитовое OR (`|`), для удаления — побитовое AND с отрицанием (`& ~`).
- При установке атрибутов методом `File.SetAttributes()` необходимо учитывать, что он заменяет все существующие атрибуты. Чтобы не потерять уже установленные атрибуты, нужно предварительно их считать и корректно обновить[^5].

```csharp
var currentAttributes = File.GetAttributes(filePath);
// Добавить атрибут System, сохраняя остальные
File.SetAttributes(filePath, currentAttributes | FileAttributes.System);
```

- Некоторые атрибуты (например, `Compressed`, `Encrypted`) в .NET Core на Linux/macOS не поддерживаются или имеют иное поведение.
- Для каталогов можно использовать свойства `DirectoryInfo.Attributes` и для файлов — `FileInfo.Attributes`, которые наследуются от `FileSystemInfo.Attributes`[^1].

> API языка C\# предоставляет богатые средства для управления атрибутами файлов Windows, но в других ОС возможности сильно ограничены. Необходимо напрямую обращаться к API конкретной ОС

<div style="text-align: center">⁂</div>

[^1]: https://learn.microsoft.com/ru-ru/dotnet/api/system.io.filesysteminfo.attributes?view=net-8.0
[^2]: https://habr.com/ru/articles/468287/
[^3]: https://learn.microsoft.com/ru-ru/dotnet/api/system.io.fileattributes?view=net-8.0
[^4]: https://metanit.com/sharp/tutorial/14.4.php
[^5]: https://otvet.mail.ru/question/96321794
[^6]: https://learn.microsoft.com/ru-ru/dotnet/csharp/advanced-topics/reflection-and-attributes/
[^7]: https://csharp.webdelphi.ru/rabota-s-fajlovoj-sistemoj-v-c-rabota-s-katalogami-klassy-directory-i-directoryinfo/
[^8]: https://metanit.com/sharp/tutorial/5.2.php
[^9]: https://learn.microsoft.com/ru-ru/dotnet/csharp/advanced-topics/reflection-and-attributes/attribute-tutorial
[^10]: https://dir.by/developer/csharp/attributes/

#C-Sharp #Files
