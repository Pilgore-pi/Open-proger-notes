
> **XPath (XML Path Language)** — это язык запросов, используемый для навигации и поиска информации в XML-документах. Он позволяет точно указать путь к элементам, атрибутам и текстовым данным, которые нужно найти в структуре XML файлов и получить данные при необходимости

XPath предлагает набор выражений, операторов и функций для указания конкретных путей обхода XML-деревьев и фильтрации данных с помощью различных критериев. Эти выражения состоят из элементов и операторов, которые можно комбинировать, чтобы получить нужные результаты

Задачи решаемые с помощью XPath:

- **Поиск** тегов, атрибутов и значений тегов

- **Проверка условий**: XPath позволяет задавать условия и проверять их в XML-документе. Например, можно проверить, что значение атрибута соответствует определенному критерию или что в XML-документе есть определенный элемент

- **Навигация по структуре**: XPath позволяет перемещаться по структуре XML-документа, находить конкретные узлы и выполнять с ними операции

## Синтаксис языка XPath

```xpath
//tagname[@Attribute='value']

//      - выбор текущего узла
tagname - имя тега
@       - указывает атрибут
'value' - значение атрибута

```

| Синтаксическая единица | Описание |
| :-------- | :-------------------  |
| `@`       | указание атрибута |
| `*`       | выбор любого элемента |
| `@*`      | выбор любого атрибута |
| `/`       | поиск от корневого узла XML (абсолютный путь XPath) |
| `//`      | относительный путь XPath |
| `.`       | поиск текущего узла |
| `..`      | родитель текущего узла |

**Типы узлов в XPath:**

- Корневой узел
- Узел элемента
- Узел атрибута
- Текстовый узел

## Практические примеры

<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

### Исходный пример HTML

```html
<html>
  <body>
    <div id="main">
      <p class="text">Привет</p>
      <p>Мир</p>
      <a href="https://example.com">Ссылка</a>
    </div>
  </body>
</html>
```


***

### Пояснение ключевых символов

#### `.` — текущий узел

Выбирает текущий элемент, относительно которого строится запрос.

- XPath: `.`
Выбирает именно текущий узел.

```
- Пример использования: внутри контекста `<div id="main">`, `.` выберет сам этот `<div>`.
```

- Ошибочный пример: `..` — это не ошибка, а переход к родителю, но `...` будет ошибкой.

***

#### `@` — выбор атрибута

Обозначает, что мы хотим выбрать атрибут у текущего или указанного тега.

- XPath: `//div/@id`
Возьмет значение атрибута `id` у всех тегов `<div>`.
- XPath: `//a/@href`
Возьмет ссылку из атрибута `href` у всех `<a>`.
- Ошибочный пример: `//@` — выражение некорректно, должен следовать атрибут.

***

#### `/` — переход к дочернему элементу (все с первого уровня)

- XPath: `/html/body/div`

```
Выбирает тег `<div>`, который — прямой потомок `<body>`, который в свою очередь — потомок корня `<html>`.
```

- Ошибочный пример: `/body/div` — ошибка, так как путь начинается с корня, а корень — это `<html>`, поэтому надо писать `/html/body/div`.

***

#### `//` — выбор узлов на любом уровне вложенности

- XPath: `//p`
Выбирает все теги `<p>` в документе, где бы они ни находились.
- Усиленный пример: `//div//p`

```
Все `<p>`, которые находятся где-то внутри `<div>`, независимо от глубины вложенности.
```

***

### Другие полезные конструкции

- `/*` — выбор всех дочерних узлов элемента (любой тег).
- `[n]` — выбрать n-й элемент из набора (нумерация с 1).
- `[contains(@class, 'text')]` — выбор элементов, у которых в атрибуте class содержится подстрока "text".

***

### Примеры валидных и ошибочных XPath для этого документа

| XPath запрос | Описание | Корректность |
| :-- | :-- | :-- |
| `/html/body/div` | Выбирает `<div>` в структуре | Валидный |
| `//p` | Все параграфы в любом месте | Валидный |
| `//div/@id` | Атрибут id у всех div | Валидный |
| `/html/body/div/p` | Первый `<p>` внутри `<div>` | Валидный |
| `//a/@href` | Ссылки из всех `<a>` | Валидный |
| `/body/div` | Ошибка: нет корневого `<body>` без `<html>` | Ошибочный |
| `//@href` | Все атрибуты href во всем документе | Валидный (но осторожно, т.к. сложно использовать) |
| `//div/@` | Ошибка: нет имени атрибута после `@` | Ошибочный |
| `...` | Ошибка: неправильный синтаксис | Ошибочный |
| `.` | Текущий узел (зависит от контекста) | Валидный |




- Любой современный браузер позволяет просматривать HTML текущей страницы и копировать XPath выбранного узла HTML

Источники:

- [XPath — примеры запросов в html для парсинга сайта](https://habr.com/ru/articles/753332/)

#Web #HTML
