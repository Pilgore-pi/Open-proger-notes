
Исключение — это непредвиденная ситуация, возникающая при ошибке выполнения программы. Ошибки могут возникать на 2 этапах:

- на этапе компиляции программы (compile time)
- на этапе выполнения программы (run time)

| Оператор    | Описание                                                                                                                              |
| :---------- | :------------------------------------------------------------------------------------------------------------------------------------ |
| **try**     | блок, внутри которого записывается код, потенциально вызывающий исключение                                                            |
| **catch**   | блок, перехватывающий и обрабатывающий исключения заданных типов                                                                      |
| **finally** | блок, который выполняется всегда после try/catch, независимо от того, было исключение или нет. Используется для освобождения ресурсов |
| **throw**   | оператор создания и "выбрасывания" исключения                                                                                         |

## Как работает обработка исключений

1. Код в блоке `try` пытается выполниться
2. Если внутри `try` возникает исключение (создается с помощью `throw` или автоматически CLR), выполнение блока прерывается
3. CLR проходит стек вызовов вверх и ищет первый подходящий `catch`, который может обработать исключение выбранного типа
4. Если `catch` найден, управление передается в него — там можно обработать ошибку
5. Если подходящего `catch` не найдено, программа аварийно завершается
6. После `try` и `catch` выполняется блок `finally` (если он есть)

```cs
try {
    
    // Код, который может вызвать исключение
    
} catch (SpecificExceptionType ex) {
    
    // Обработка конкретного типа исключения
    
} catch (Exception ex) {
    
    // Обработка всех остальных исключений
    
} finally {
    
    // Код, который выполнится в любом случае (например, освобождение ресурсов)
}
```

Пример простой обработки исключения

```cs
try {
    int a = 10;
    int b = 0;
    int c = a / b; // вызвать исключение DivideByZeroException
} catch (DivideByZeroException) {
    Console.WriteLine("Деление на ноль недопустимо");
} finally {
    Console.WriteLine("Этот блок выполнится всегда");
}
```

Можно создавать собственные классы исключений, наследуя от `Exception`:

```cs
public class MyCustomException : Exception {
    public MyCustomException(string message) : base(message) { }
}
```

> Важно перехватывать исключения **от более специфичных к более общим**, чтобы правильно обработать каждое из них

```cs
try {
    // Код
}
catch (ArgumentNullException ex) {
    Console.WriteLine("Пустой аргумент");
}
catch (ArgumentException ex) {
    Console.WriteLine("Некорректный аргумент");
}
catch (Exception ex) {
    Console.WriteLine("Общее исключение");
}
```

 #Dotnet #C-Sharp