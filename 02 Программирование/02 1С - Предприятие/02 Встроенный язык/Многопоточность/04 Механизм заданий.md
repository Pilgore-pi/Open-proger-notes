[Источник](https://xn----1-bedvffifm4g.xn--p1ai/news/async-metods-article/)

Механизм заданий предназначен для выполнения какой-либо прикладной функциональности по расписанию или асинхронно

**Механизм заданий решает следующие задачи:**

- возможность определения регламентных процедур на этапе конфигурирования системы;

- выполнение заданных действий по расписанию;

- выполнение вызова заданной процедуры или функции асинхронно, т. е. без ожидания ее завершения;

- отслеживание хода выполнения определенного задания и получение его статуса завершения (значения, указывающего успешность или неуспешность его выполнения);

- получение списка текущих заданий;

- возможность ожидания завершения одного или нескольких заданий;

- управление заданиями (возможность отмены, блокировка выполнения и др.).

**Механизм заданий состоит из следующих компонентов:**

- метаданных регламентных заданий,

- регламентных заданий,

- фоновых заданий,

- планировщика заданий.

**Регламентные задания** предназначены для выполнения прикладных задач по расписанию. Регламентные задания хранятся в информационной базе и создаются на основе метаданных, определяемых в конфигурации. Метаданные регламентного задания содержат такую информацию, как наименование, метод, использование и т. д.

Регламентное задание имеет расписание, которое определяет, в какие моменты времени нужно выполнять связанный с регламентным заданием метод. Расписание, как правило, задается в информационной базе, но может быть задано и на этапе конфигурирования (например, для предопределенных регламентных заданий).

## Фоновые задания

Фоновые задания предназначены для выполнения прикладных задач асинхронно, реализуются средствами встроенного языка.

Планировщик заданий используется для планирования выполнения регламентных заданий. Для каждого регламентного задания планировщик периодически проверяет, соответствует ли текущая дата и время расписанию регламентного задания. Если соответствует, планировщик назначает такое задание на выполнение. Для этого по данному регламентному заданию планировщик создает фоновое задание, которое и выполняет реальную обработку.

Фоновые задания удобно использовать для выполнения сложных вычислений, когда результат вычисления может быть получен через продолжительное время. Механизм заданий имеет средства для выполнения таких вычислений асинхронно.

С фоновым заданием связан метод, который вызывается при выполнении фонового задания.

- В качестве метода фонового задания может выступать любая процедура или функция не глобального общего модуля, которую можно вызвать на сервере

- Параметрами фонового задания могут быть любые значения, которые разрешено передавать на сервер

- Параметры фонового задания должны в точности соответствовать параметрам той процедуры или функции, которую оно вызывает

- Параметры фонового задания, в сериализованном виде, не могут превышать размер в 1 Гбайт. При превышении размера, генерируется исключение

- Если методом фонового задания является функция, то ее возвращаемое значение игнорируется

> Фоновое задание может иметь ключ ‑ значение любого типа данных. Ключ вводит ограничение на запуск фоновых заданий ‑ в единицу времени может выполняться только одно фоновое задание с определенным значением ключа и заданным именем метода фонового задания (имя метода состоит из имени модуля и имени процедуры или функции)

Ключ позволяет группировать фоновые задания, имеющие одинаковые методы, по определенному прикладному признаку с тем, чтобы в рамках одной группы выполнялось не более одного фонового задания

- Создание и управление фоновыми заданиями выполняются программно из любого соединения

- Создавать фоновое задание разрешено любому пользователю. При этом оно выполняется от имени того пользователя, который его создал

- Получать задания, а также ожидать их завершения разрешено из любого соединения пользователю с административными правами либо пользователю, который создал эти фоновые задания

- Фоновое задание является чисто сеансовым объектом, но не принадлежит какому-либо пользовательскому сеансу

- Для каждого задания создается специальный системный сеанс, выполняющийся от имени того пользователя, который выполнил вызов

- Фоновые задания не имеют сохраняемого состояния

Фоновое задание может порождать другие фоновые задания. В клиент-серверном варианте это позволяет распараллеливать сложные вычисления по рабочим процессам кластера, что может значительно ускорить процесс вычисления в целом. Распараллеливание реализуется порождением нескольких дочерних фоновых заданий с ожиданием завершения каждого из них в основном фоновом задании

- Фоновое задание имеет возможность помещать данные во временное хранилище вызывающего сеанса

- Передача данных из вызывающего сеанса в сеанс фонового задания невозможна

https://its.1c.ru/db/v8313doc#bookmark:dev:TI000002036

----

> **Фоновые задания** — это объекты конфигурации, которые являются механизмом параллельного выполнения работы

> Работа с фоновыми заданиями доступна только на сервере

При выполнении длительных действий в фоновом задании нет возможности получить “уведомление” от сервера, что фоновое задание завершено, чтобы получить подготовленные данные и загрузить их в табличную часть документа. Поэтому приходится подключать обработчик ожидания, который с заданной периодичностью проверяет состояние фонового задания с определенным идентификатором. Как только такая проверка определяет, что фоновое задание завершилось, можно приступать к обработке данных, помещенных во временное хранилище в фоновом задании.

> Длительные операции с использованием фоновых заданий и асинхронные методы – это принципиально разные механизмы асинхронного выполнения

---

Чтобы из клиентского приложения можно было проверить состояние запущенного фонового задания (завершено успешно, еще выполняется или завершено с ошибкой), его идентификатор также хранится в реквизите формы `ИдентификаторЗадания`

----

> Фоновое задание — это объект встроенного языка. Он является частью механизма заданий.

Фоновые задания предназначены для выполнения прикладных задач асинхронно. Они могут порождать дочерние фоновые задания, например, для распараллеливания сложных вычислений по различным рабочим серверам кластера в клиент-серверном варианте работы.

Существует возможность ограничить выполнение фоновых заданий, имеющих одинаковые методы, по определенному прикладному признаку. Программное создание и управление фоновыми заданиями возможно из любого соединения пользователя с информационной базой системы 1С:Предприятие 8. Фоновое задание выполняется от имени пользователя, который его создал.

Ведется история выполнения фоновых заданий. Все задания разделены на три типа (программные, системные, регламентные) и для каждого типа существует собственное ограничение на количество хранимых записей в истории. Это упрощает анализ истории в тех случаях, когда в системе исполняется большое количество заданий одного типа. Они вытесняют из истории только задания своего типа, а задания других типов остаются доступными для анализа.

#1С #1С/Многопоточность
