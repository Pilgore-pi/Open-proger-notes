
#Syntax/1С/Async

**[ПРОДОЛЖЕНИЕ](https://wonderland.v8.1c.ru/blog/uluchsheniya-v-sintaksise-yazyka-1s-dlya-raboty-s-asinkhronnymi-funktsiyami/)**

Асинхронные методы в 1С такие же, как и везде. Асинхронный метод выполняется в фоновом потоке параллельно с основным. В недавней версии (по состоянию на 2024 год) в версии 8.3.18 был добавлен специальный синтаксис и тип:

```bsl
асинх процедура ИмяПроцедуры(<параметры>) //async
  [ждать] <Обещание>;                     //await
конецПроцедуры

асинх функция ИмяФункции(<параметры>)
  возврат <Значение>;
конецФункции
```

>Все параметры асинхронных функций передаются только **по значению**

Любая асинхронная функция возвращает **`Обещание`** или **`Promise`**.

>***Обещание*** (аналог C# — тип `Task`) — это контейнер, который содержит в себе значение некоторого типа. Предполагается, что в будущем `Обещание` вернет результат, но это не гарантировано. Например, существует обещание: получить данные из БД. Такое "обещание" говорит, что после выполнения операции получения данных из БД, мы сможем использовать результат обещания, но пока запрос к БД не выполниться, мы будем ждать результата, параллельно выполняя основную логику программы.

Существует 3 исхода выполнения асинхронной функции:

1. Мы **дождались** выполнения асинхронного метода и получили результат.
2. Мы **ждем** выполнения асинхронного метода и не получили результат, так как метод все еще выполняется. Возможно, асинхронный метод будет выполняться бесконечно.
3. Мы **не дождались** результата, так как асинхронный метод завершился с ошибкой (вернул `Неопределено`).

Как можно понять, нельзя всегда гарантированно получить результат, поэтому был введен тип `Обещание`, который обрабатывает такую логику и допускает все перечисленные состояния.

Оператор `ждать` может быть использован только внутри асинхронного метода. Этот оператор говорит, что нужно остановить выполнение кода и ждать до тех пор, пока `Обещание` не вернет значение. Если не использовать `ждать`, то ожадания не будет и код продолжит свое выполнение.



### Описание оповещения

В предыдущих версиях асинхронные методы самостоятельно создавать было нельзя. Использовались только встроенные методы, которые в качестве параметра получают некий объект `ОписаниеОповещения`, который содержит информацию о том, какой метод вызвать после завершения асинхронного метода.

Такой подход вынуждает создавать 2 функции вместо одной, если не использовать новый синтаксис.

У большинства встроенных асинхронных методов есть параметр, в который помещается обработчик завершения этого метода. Обработчик завершения представлен типом "ОписаниеОповещения"

>ОписаниеОповещения — это объект, который содержит информацию о методе, который нужно выполнить после завершения асинхронного метода. Обработчик завершения должен быть **экспортным** (открытым)

```bsl
ОпОп = новый ОписаниеОповещения;

// или конструктор с инициализацией

ОпОп = новый ОписаниеОповещения(
    // Имя ЭКСПОРТИРУЕМОЙ процедуры
    имяПроцедуры,
    
    //Модуль, в котором определена процедура
    //Тип: ФормаКлиентскогоПриложения, ОбщийМодуль, Строка, Команда..
    модульПроцедуры,
);
```

Если основная процедура **оповещения** определена в том же модуле, где происходит вызов асинхронной процедуры, то можно в качестве модуля передать ссылку на текущий модуль.

```bsl
оповещение = новый ОписаниеОповещения("ПроцедураПослеВводаЗначения", ЭтотОбъект);
ПоказатьВводЗначения(оповещение, ...);
```


# СИНХРОНИЗИРОВАТЬ С ЗАМЕТКОЙ "МЕТОДЫ ИНТЕРАКТИВНОЙ РАБОТЫ"

* Модификатор `асинх` можно использовать только для функций, выполняющихся на клиенте.

#1С #Threads/Async #1С/Многопоточность