
## Виды сетей

По всему миру компьютеры связаны между собой сетями (локальными, глобальными, Интернетом). Все подключенные устройства связаны каналами связи — кабели Ethernet, Wi-Fi, маршрутизаторами и др.

В зависимости от охвата территории компьютерные сети бывают:

1. **Персональные** — Personal Area Network (PAN)
2. **Локальные** — Local Area Network (LAN)
3. **Городские** — Metropolitan Area Network (MAN)
4. **Глобальные** — Wide Area Network (WAN)

## Виды сетевых протоколов

> **Протоколы** — это соглашения о том, как пакеты будут передаваться по каналам коммуникации. Таким образом протоколы упорядочивают и стандартизируют взаимодействие хостов. Многие сетевые протоколы реализованы в ядре операционной системы, что упрощает использование этих протоколов

Канальный уровень:

- ARP (протокол разрешения адресов),
- RARP (обратное разрешение),
- Ethernet (протокол передачи данных в локальных сетях),
- Wi-Fi (беспроводной протокол),
- MPLS (маршрутизация с метками).

Сетевой уровень:

- IP (IPv4 и IPv6) — адресация и маршрутизация,
- ICMP — управляемые сообщения и диагностика,
- IGMP — управление группами мультимедиа,
- OSPF, BGP, RIP — протоколы динамической маршрутизации,
- IPX — протокол сетевого уровня в старых сетях

Транспортный уровень:

- TCP — надежная передача с установкой соединения,
- UDP — быстрая передача без гарантии доставки,
- SCTP — протокол с поддержкой множественных потоков и адресов.

Прикладной уровень:

- HTTP и HTTPS — протоколы передачи веб-страниц,
- FTP — передача файлов,
- SMTP, POP3, IMAP — работа с электронной почтой,
- DNS — разрешение доменных имен,
- DHCP — автоматическое назначение IP-адресов,
- SNMP — управление сетью,
- SSH — безопасное удаленное управление,
- NTP — синхронизация времени.

Семейство протоколов `TCP/IP` используются для передачи данных по сети. Основные протоколы этого семейства:

Сетевые протоколы и модели регламентируются серией открытых документов Request For Comments (RFC), составляемых отдлельными специалистами или группами специалистов. К примеру, модель TCP/IP описывается документами [RFC 1122 (Requirements for Internet Hosts — Communication Layers)](https://datatracker.ietf.org/doc/html/rfc1122) и [RFC 1123 (Requirements for Internet Hosts — Application and Support)](https://datatracker.ietf.org/doc/html/rfc1123)

## Виды сетевых протоколов

> **Сетевой шлюз** — это устройство или программное обеспечение, которое служит точкой соединения между двумя сетями, часто использующими разные протоколы. Он выполняет функцию «переводчика», преобразуя данные из одного протокола или формата в другой, что обеспечивает совместимость и позволяет сетям взаимодействовать

### Internet Protocol (IP)

Протокол IP (Internet Protocol) — это основной сетевой протокол в модели TCP/IP, отвечающий за адресацию и маршрутизацию пакетов данных между устройствами в сети. Его задача — разбивать данные на пакеты и доставлять их по нужному адресу, используя уникальные IP-адреса

IP не гарантирует доставку пакетов как TCP, а просто переносит их «от источника к получателю», при этом пакеты могут идти разными маршрутами и прибывать в произвольном порядке либо даже потеряться. Для определения маршрута передачи протокол IP взаимодействует с маршрутизаторами, которые анализируют IP-адрес назначения и выбирают оптимальный путь.

Кроме адресации IP-пакеты содержат и служебную информацию, такую как адрес отправителя, время жизни (TTL) и другую, необходимую для корректной пересылки. Среди версий протокола IP наиболее популярны IPv4 и IPv6 — первая более распространена, вторая обеспечивает больше адресов и новые возможности

#### Механизм работы протокола IPv4

Структура заголовка IPv4:

| Поле                   | Размер в битах | Описание  |
| ---------------------- | -------------- | --------- |
| Номер версии IP адреса | 4              | Значение для IPv4: `4`   |
| Длина заголовка        | 4              |         |
| Тип обслуживания       | 8              | Набор битовых флагов, который определяет параметры обслуживания пакета |
| Общая длина            | 16             | Размер пакета в байтах |
| ID пакета              | 16             | Идентификатор фрагмента IP пакета. Пакеты данных могут разбиваться на фрагменты, если на **канальном уровне** есть ограничения на размер пакета, которое не соблюдается   |
| Зарезервированный флаг | 1              | Не используется |
| Флаг `DF`              | 1              | `1`: фрагментация запрещена |
| Флаг `MF`              | 1              | `1`: это не последний фрагмент пакета; `0`: это последний фрагмент  |
| Смещение фрагмента     | 13             | Если смещение фрагмента И флаг `MF` установлены в 0, то текущий пакет данных считается полноценным пакетом, а не фрагментом |
| Время жизни            | 8              | Определяет, сколько раз пакет может быть передан с одного устройства на другое. При получении пакета данных текущее устройство уменьшает значение этого параметра на 1. Предназначен для ошищения зависших пакетов данных |
| Тип протокола          | 8              | Число, указывающее на тип используемого транспортного протокола |
| Контрольная сумма      | 16             | Рассчитывается на каждом маршрутизаторе в цепочке сетевого соединения, так как заголовок может меняться |
| IPv4 отправителя       | 32             |   |
| IPv4 получателя        | 32             |   |
| (Необязательные поля)  |                |   |

Если на межсетевом уровне возникает ошибка, то маршрутизатор формирует пакет с **ICMP** сообщением о отправляет обратно отправителю

#### Механизм работы протокола IPv6

Структура заголовка IPv6:

| Поле                    | Размер в битах | Описание |
| ----------------------- | -------------- | -------- |
| Номер версии            | 4              | Значение для IPv6: `6` |
| Класс трафика           | 8              | Аналог поля "Тип обслуживания" |
| Метка потока            | 16             | Идентификатор, позволяющий маршрутизатору кэшировать заголовки и не далать их анализ заново, если метка потока совпадает с той, что уже есть в кэше |
| Длина полезной нагрузки | 16             | Длина данных |
| Следующий заголовок     |                | Аналог поля IPv4 "Тип протокола" |
| Число переходов         | 8              | Аналог поля "Время жизни" |
| IPv4 отправителя        | 128            |                           |
| IPv4 получателя         | 128            |                           |


### Transmission Control Protocol (TCP)

> **TCP ()** — 

#### Механизм работы

1) Сообщение делится на сегменты

2) Для каждого сегмента формируется заголовок TCP. При этом сегменты не синхронизированы. Один сегмент может прийти раньше другого или вообще потеряться в следствии, например, плохого соединения

3) В процессе приема сообщения при получении каждого сегмента сообщения получатель отправляет подтверждение того, что получатель принял сегмент. Отправитель при этом запускает таймер ожидания подтверждения, по истечении которого заново отправляет сегмент данных. Получатель может получить сообщение, но отправитель не получить подтверждение. В таком случае отправитель заново отправляет сообщение, а получатель отбрасывает его, анализируя порядковый номер сегмента (определенный в заголовке) и заново отправляет подтверждение отправителю

Структура заголовка TCP:

| Поле                         | Размер в битах | Описание |
| ---------------------------- | -------------- | -------- |
| Порт отправителя             | 16             |          |
| Порт получателя              | 16             |          |
| Порядковый номер             | 32             | Номер первого байта текущего сегмента сообщения. Эта информация нужна для последующей синхронизации всех сегментов и формирования сообщения на стороне получателя |
| Номер подтверждения          | 32             | Номер следующего ожидаемого байта сообщения |
| Длина заголовка              | 4              |                                             |
| 3 выравнивающих нулевых бита | 3              |                                             |
| Флаг `NS`                    | 1              | Служит для предотвращения случайного изменения или неизменения флагов `CWR` и `ECE` |
| Флаг `CWR`                   | 1              | Флаг подтверждения о перегрузке сети от отправителя (см. флаг `ECE`) |
| Флаг `ECE`                   | 1              | Флаг подтверждения о перегрузке сети от получателя. Маршрутизатор при перегрузке может отправить получателю сегмент с измененным заголовком IP, тогда получатель в сегменте-подтвеждении устанавливает флаг `ECE`. В ответ отправитель также отправляет подтверждение с флагом `CWR` |
| Флаг `UGR`                   | 1              | Определеяет, содержит ли сегмент срочные данные, необходимые программе |
| Флаг `ACK`                   | 1              | Ставится при получении сегмента получателем. Отправитель анализирует флаг и определяет, нужно ли считывать данные по **номеру подтвеждения** или нет |
| Флаг `PSH`                   | 1              | Указывает на то, что сегмент нужно передавать программе сразу без внесения в промежуточный буфер |
| Флаг `RST`                   | 1              | Флаг, который говорит о критической ошибке. Отправитель сегмента с данным флагом не ожидает ответа и экстренно разрывает соединение. Получатель также разрывает соединение без отправки подтверждения |
| Флаг `SYN`                   | 1              | Определяет создано ли предварительное соединение для передачи сообщения по протоколу TCP |
| Флаг `FIN`                   | 1              | Указывает на то, что у передающей стороны больше нет данных для передачи. При попытке разрыва соединения отправитель и получатель отправляют сегмент с флагом `FIN` и в ответ ожидают  подтверждение с флагом `ACK` |
| Размер окна (буфера)         | 16             | Определяет размер буфера сегментов |
| Констрольная сумма           | 16             | Хэш-значение, вычисляемое на основе заголовка и содержимого всего сообщения |
| Указатель на срочные данные  | 16             | |
| (Необязательные параметры)   | ?              | Часть заголовка с неизвестной длиной. Информация о размере заголовка храниться в поле "Длина заголовка" |

### User Datagram Protocol (UDP)

В отличие от TCP протокола, UDP:

- Не контролирует целостность передаваемых данных
- Не создает предварительного подключения
- Не анализирует перегрузку сети
- Не ожидает подтверждения о получении сегментов
- Не занимается управлением размера окна
- Гораздо быстрее
- Заголовок UDP занимает всего 8 байт

Структура заголовка UDP:

| Поле                             | Размер в битах | Описание       |
| -------------------------------- | -------------- | -------------- |
| Порт отправителя                 | 16             | необязательное |
| Порт получателя                  | 16             |                |
| Длина заголовка вместе с данными | 16             |                |
| Контрольная сумма                | 16             | необязательное |

### HTTP

HTTP (HyperText Transfer Protocol — протокол передачи гипертекста) — 

Список HTTP-статусов, сгруппированных по категориям:

100ые — Информационные ответы

| Код | Описание |
|-----|---------|
| **100** | Сервер получил заголовки запроса, клиент может отправить тело запроса |
| **101** | Сервер согласен переключиться на другой протокол (например, WebSocket) |
| **103** | Сервер отправляет предварительные заголовки перед основным ответом |

200ые — Успешные ответы

| Код | Описание |
|-----|---------|
| **200** | Запрос выполнен успешно |
| **201** | Создан новый ресурс (например, при POST-запросе) |
| **204** | Запрос обработан, но нет данных для возврата |
| **206** | Возвращена часть ресурса (например, при загрузке фрагментов) |

300ые — Перенаправления

| Код | Описание |
|-----|---------|
| **301** | Постоянное перенаправление (ресурс перемещён навсегда) |
| **302** | Временное перенаправление (ресурс временно недоступен) |
| **304** | Ресурс не изменился с момента последнего запроса |

400ые — Ошибки клиента

| Код | Описание |
|-----|---------|
| **400** | Некорректный запрос (например, неверный формат данных) |
| **401** | Неавторизованный доступ (требуется аутентификация) |
| **403** | Запрещён доступ (права пользователя недостаточны) |
| **404** | Ресурс не найден |
| **429** | Слишком много запросов (ограничение скорости) |

500ые — Ошибки сервера

| Код | Описание |
|-----|---------|
| **500** | Внутренняя ошибка сервера |
| **503** | Сервис временно недоступен (например, перегрузка) |
| **504** | Превышено время ожидания ответа от шлюза |

**Примечание**: В таблицах приведены основные коды, наиболее часто используемые в разработке. Для полного списка можно обратиться к спецификациям RFC 7231 и RFC 6585

#### HTTPS



### SSH



### FTP



### Dynamic Host Configuration Protocol (DHCP)

> **DHCP (Dynamic Host Configuration Protocol)** — это сетевой протокол, предназначенный для автоматического назначения IP-адресов и других сетевых параметров устройствам в сети TCP/IP. Его главная задача — упростить и автоматизировать процесс конфигурации сети, избавляя пользователей и администраторов от необходимости вручную настраивать IP-адреса, маски подсети, шлюзы и другие важные параметры

Работа DHCP основана на модели клиент-сервер и происходит по схеме **DORA**, которая включает четыре основных этапа:

- **Обнаружение (Discover)** — клиент, подключаясь к сети, посылает широковещательное сообщение DHCPDISCOVER, в котором сообщает о своём желании получить адрес.

- **Предложение (Offer)** — один или несколько DHCP-серверов отвечают сообщением DHCPOFFER, в котором предлагают клиенту IP-адрес и другие параметры конфигурации.

- **Запрос (Request)** — клиент выбирает один из предложенных адресов и посылает DHCPREQUEST, подтверждая своё согласие с предложенной конфигурацией.

- **Подтверждение (Acknowledge)** — сервер подтверждает выдачу адреса сообщением DHCPACK, и клиент начинает использовать назначенный IP-адрес.

Сообщения DHCP передаются по протоколу UDP, используя порты 67 (сервер) и 68 (клиент). DHCP также позволяет управлять временем аренды IP-адресов, автоматически обновляя или освобождая адреса в зависимости от состояния подключённых устройств.

Таким образом, DHCP обеспечивает эффективное управление IP-адресами в сетях, поддерживает масштабируемость и предотвращает конфликты адресов, делая сетевую инфраструктуру более удобной для эксплуатации и управления

### Internet Control Message Protocol (ICMP)

**ICMP (Internet Control Message Protocol)** — это сетевой протокол, используемый для обмена служебными сообщениями и диагностикой состояния сети. Основное назначение ICMP — передача сообщений об ошибках и другой контрольной информации, чтобы устройства в сети могли уведомлять друг друга о проблемах с доставкой пакетов.

ICMP широко применяется в таких инструментах, как ping и traceroute. Например, ping использует ICMP-эхо-запросы (echo request) и ICMP-эхо-ответы (echo reply) для проверки доступности устройства в сети. Кроме того, ICMP информирует об ошибках, таких как недостижимость узла, превышение времени жизни пакета (TTL), необходимость фрагментации и другие ситуации

Структура заголовка ICMP сообщения:

| Поле              | Размер в битах | Описание |
| ----------------- | -------------- | -------- |
| Тип сообщения     | 8              | содержит идентификатор ошибки |
| Код сообщения     | 8              | содержит идентификатор более конкретной ошибки |
| Контрольная сумма | 16             | |
| Служебные данные  | 32             | |

### Addres Resolution Protocol (ARP)

> **Протокол ARP (Address Resolution Protocol)** предназначен для разрешения IP-адресов в соответствующие MAC-адреса устройств внутри локальной сети. Его главная задача — помочь устройствам, которые знают IP-адрес назначения, определить физический адрес (MAC), необходимый для передачи данных на канальном уровне

Принцип работы ARP следующий: когда устройство хочет отправить данные другому устройству в той же сети, оно проверяет свою ARP-таблицу (кэш) на предмет соответствия IP и MAC. Если нужная запись отсутствует, устройство рассылает ARP-запрос — широковещательное сообщение с просьбой ответить, кто имеет указанный IP-адрес. Устройство с этим IP посылает ARP-ответ, содержащий свой MAC-адрес. Исходное устройство записывает это соответствие в таблицу и использует MAC для создания кадра и передачи данных.

Протокол ARP играет критически важную роль в сетевой инфраструктуре, обеспечивая правильную маршрутизацию данных внутри локальных сетей и минимизируя накладные расходы за счёт кэширования адресов. Его работа прозрачна для пользователя, и он автоматически решает задачи сопоставления адресов при сетевом обмене

### SMTP

> **SMTP (Simple Mail Transfer Protocol)** — это стандартный сетевой протокол прикладного уровня, предназначенный для отправки и передачи электронной почты между почтовыми серверами и клиентами.

Основное назначение SMTP — обеспечить надежную доставку email-сообщений от отправителя к получателю через сеть TCP/IP. Протокол управляет установлением соединения между почтовым клиентом (или сервером отправителя) и SMTP-сервером, передачей команд и данных письма, а также подтверждением успешной передачи или ошибками.

Механизм работы SMTP включает несколько ключевых шагов:

1. Клиент (почтовое приложение или сервер) устанавливает соединение с SMTP-сервером получателя по порту 25 (или 587/465 для защищенных соединений).

2. Сессия начинается с приветствия (команды `HELO`/`EHLO`), после чего клиент передает адрес отправителя и адрес получателя.

3. Затем клиент передает содержимое письма командой `DATA`, включая заголовки и тело сообщения.

4. Сервер подтверждает успешный прием письма или возвращает ошибку.

5. После передачи данных сессия закрывается.

Если получатель находится на другом сервере, SMTP-сервер отправителя пересылает письмо через цепочку промежуточных SMTP-серверов до конечного адресата.

SMTP — один из самых распространенных и базовых протоколов в работе электронной почты, обеспечивающий стандартизованный и упорядоченный способ отправки сообщений в интернете

#Network #GENERATED
