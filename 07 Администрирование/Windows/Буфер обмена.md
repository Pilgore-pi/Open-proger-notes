
> **Буфер обмена Windows** - это системный механизм для временного хранения данных, которые пользователь или приложения могут копировать, вырезать и вставлять между приложениями или внутри одного приложения. Он позволяет обмениваться информацией в различных форматах, обеспечивая гибкость и совместимость

В буфере обмена Windows одновременно может храниться один и тот же объект в нескольких форматах. Это делается для того, чтобы приложение, принимающее данные из буфера, могло выбрать наиболее подходящий для себя формат. Например, при копировании форматированного текста из текстового редактора в буфер помещаются:

- Формат RTF (зарегистрированный формат с сохранением форматирования),
- Обычный текст (`CF_TEXT` или `CF_UNICODETEXT`),
- Другие форматы, если нужны.

При вставке приложение выберет самый подходящий формат из доступных

Буфер обмена Windows может содержать данные в следующих форматах (WinAPI):


| Идентификатор                       | Описание              | Формат                                        |
| ----------------------------------- | --------------------- | --------------------------------------------- |
| `CF_OEMTEXT`                        | Текст                 | Текст в кодировке OEM                         |
| `CF_TEXT`                           | Текст                 | Текст в кодировке ANSI                        |
| `CF_UNICODETEXT`                    | Текст                 | Текст в кодировке UTF-16                      |
| `CF_HDROP`                          | Список файлов         |                                               |
| `CF_BITMAP`                         | Растровое изображение | Растровое изображение Bitmap                  |
| `CF_DIB`, `CF_DIBV5`                | Растровое изображение | Изображение Bitmap, независимое от устройства |
| `CF_METAFILEPICT`, `CF_ENHMETAFILE` | Векторное изображение |                                               |
|                                     |                       |                                               |

Если стандартных форматов недостаточно для хранения данных без потерь, приложения могут создавать свои собственные форматы - зарегистрированные форматы буфера обмена. Они регистрируются через функцию **RegisterClipboardFormat** и позволяют передавать сложные или специфичные данные, например, форматированный текст RTF, HTML, объекты OLE и т.п.

Windows умеет автоматически преобразовывать данные между некоторыми форматами. Например, если в буфере есть CF_BITMAP, а приложение запросило CF_DIB, система сделает конвертацию. Это упрощает работу с буфером обмена и снижает необходимость помещать в буфер множество форматов вручную

#### Механизм работы с буфером обмена

- Приложение открывает буфер обмена вызовом **OpenClipboard**,
- Очищает буфер **EmptyClipboard**,
- Помещает данные в один или несколько форматов через **SetClipboardData**,
- Закрывает буфер вызовом **CloseClipboard**[3](https://habr.com/ru/articles/339442/).

При этом данные помещаются в глобальную память, и буфер обмена управляет их жизненным циклом

#### История буфера обмена

В Windows 10 (начиная с версии 1809) и новее появилась функция **Буфер обмена с историей**. Она расширяет классический буфер обмена следующим образом:

- Хранит не только последний скопированный элемент, а множество последних элементов (текст, изображения, HTML и другие форматы),
- Позволяет просматривать историю скопированных данных через сочетание клавиш **Win + V**,
- Позволяет закреплять важные элементы в истории, чтобы они не удалялись,
- Синхронизирует историю буфера обмена между устройствами пользователя через облако (если включена соответствующая опция),
- Позволяет вставлять любой элемент из истории в текущий документ или приложение

#OS/Windows