Назад: [[08 Встроенные делегаты|Встроенные делегаты]]

> **Событие** — это факт совершившегося действия или изменения состояния объекта. При возникновении события, все объекты, отслеживающие его, могут в момент возникновения события выполнять различные операции. Эти операции можно задавать с помощью сторонних объектов, не имеющим понятия о внутренней реализации объекта, вызвавшего событие.

*Таким образом, в C\# реализуется событийно-ориентированная парадигма*

С точки зрения .NET, событие — это именованный делегат, при вызове которого, будут запущены все методы, подписавшиеся на событие. Другими словами, событие — делегат, доступный снаружи только для отслеживания и недоступный для вызова.

Синтаксис определения событий:

```cs
// Событие как поле
[<modifier>] event <Delegate> MyEvent;

// Событие как свойство
[<modifier>] event <Delegate> MyEvent { add; remove; }
[<modifier>] event <Delegate> MyEvent { add => ...; remove => ...; }
[<modifier>] event <Delegate> MyEvent
{
    add { ... }
    remove { ... }
}
```

Примеры объявления событий:

```csharp
// Простое событие (как поле) на уровне экземпляра, на основе встроенного делегата
event Action EverythingExploded;

// Простое событие (как поле) на уровне типа, на основе кастомного делегата
public delegate void CustomAction(int x);
public static event CustomAction? SomeoneFell;

// Сложное событие (как свойство) с явно определенными аксессорами и встроенным делегатом
private event Action _someoneWokenUp;
public event Action SomeoneWokenUp {
    add {
        if (isEventSubscriptionLocked == false)
            _someoneWokenUp += value;
    }
    remove {
        _someoneWokenUp -= value;
    }
}

// Сложное событие (как свойство) с явно определенными аксессорами и кастомным делегатом
public delegate void CustomAction(int x);

private event CustomAction _someoneWokenUp;
public event CustomAction SomeoneWokenUp {
    add {
        if (isEventSubscriptionLocked == false)
            _someoneWokenUp += value; // подписка на событие
    }
    remove {
        _someoneWokenUp -= value;     // отписка от события
    }
}
```

События могут содержаться в:

- структурах
- классах
- интерфейсах

> **Обработчик события (Event handler)** — это метод, соответствующий типу делегата события, который вызывается при происшествии события.

Событие могут обрабатывать несколько обработчиков, благодаря тому, что событие основано на делегате, который может хранить набор ссылок на методы

Тип, в котором определяется событие (класс, структура, интерфейс), обладает полным доступом над событием. Он может вызывать событие, когда угодно. Снаружи типа можно выполнить только 2 действия:

1) Подписка на событие (`add`, `myEvent += EventHandler`)
2) ~~Дизлайк~~ Отписка от события (`remove`, `meEvent -= EventHandler`)

Есть 3 способа непосредственного запуска события из определяющего типа:

1) `MyEvent(...)` — вызов события в стиле синтаксиса делегата
2) `MyEvent.Invoke(...)` — вызов события, не допускающего `null`
3) `MyEvent?.Invoke(...)` — вызывает событие, допускающее `null`, или, если событие не содержит ссылок на обработчики, то возвращается `null`

Для событий определен специальный синтаксис, похожий на синтаксис свойств. Также имеется 2 метода, инкапсулирующих доступ к подписке и отписки от события. Эти методы называются `add_<EventName>` и `remove_<EventName>`. К ним можно обратиться следующим образом:

```csharp
delegate void AccountHandler(string message);

private event AccountHandler _notify;

public event AccountHandler Notify {
	add	{
		_notify += value;
		//...
	}
	remove {
		_notify –= value;
		//...
	}
}
```

## Отличия делегата и события

1. Делегат можно вызвать где угодно, поэтому нельзя его использовать как событие, так как кто угодно сможет его вызвать.
2. Событие содержит приватное поле-делегат со ссылками на все обработчики событий
3. Событие содержит 2 метода подписки и отписки от события.
4. Событие, не может быть локальной переменной в методе
5. Событие может быть полем или свойством со специальными аксессорами `add` и `remove`

В .NET существует установленный стандарт формы обработчиков событий:

```csharp
void Handler(object? sender, EventArgs e) {...}
```

`EventArgs` — базовый класс для всех классов, предназначенных для передачи информации событий.

#C-Sharp #C-Sharp/Functions/Delegates