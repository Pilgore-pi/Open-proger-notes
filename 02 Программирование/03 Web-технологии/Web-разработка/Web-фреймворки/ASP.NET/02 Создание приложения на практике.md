## Описание функционала

Приложение со списком шуточных вопросов

Поддерживаемые операции: CRUD

- Create (Создание)
- Read (Чтение)
- Update (Редактирование)
- Delete (Удаление)

Шутки и ответы будут храниться в базе данных MS SQL Server

## Алгоритм действий

### 1 Создание проекта по шаблону

**В Visual Studio:**
- `ASP.NET Core Web Application`
- Выберите последнюю версию .NET
- Выберите шаблон проекта ASP.NET: `Web Application (Model-View-Controller)`
- Аутентификация: `Individual user accounts`

**В JetBrains Rider:**
- `Web > Web App (Model-View-Controller)`
- Выберите последнюю версию .NET
- Аутентификация: `Auth > Individual authentication`

MVC версия проекта является Full-stack решением, поэтому никакие фронтенд фреймворки использоваться не будут

- По умолчанию в проекте уже создана база данных SQL

### 2 Запуск проекта

Запустим проект. При запуске должна открыться главная страница приложения в браузере по умолчанию.

По умолчанию, на странице уже есть сслыки на 2 страницы:

- `Home`
- `Privacy`

А также элементы управления перехода к странице регистрации или входа

### 3 Редактирование представлений

Изменим контент стартовой страницы, изменив текст на ней. Откроем файл в проекте "`Views/Home/Index.cshtml`". Он будет содержать примерно такое содержимое:

```razor
@{  
    ViewData["Title"] = "Home Page";  
}  
  
<div class="text-center">  
    <h1 class="display-4">Welcome</h1>  
    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>  
</div>
```

Заменим английский текст на русский:

```razor
@{  
    ViewData["Title"] = "Домашняя страница";  
}  
  
<div class="text-center">  
    <h1 class="display-4">Добро пожаловать</h1>  
    <p>Узнайте больше о <a href="https://learn.microsoft.com/aspnet/core">разработке веб-приложений с помощью ASP.NET Core</a>.</p>  
</div>
```

`ViewData["Title"]` — это свойство, которое хранит текст заголовка страницы (аналог HTML `<title>`) 

### Пояснение паттерна проектирования MVC

Представления, согласно паттерну MVC — это интерфейс приложения, с которым работает пользователь, в данном случае это **Razor HTML + CSS**

Модели — это структуры данных и модули (классы и объекты), содержащие сервисную логику (например инициализация БД, описание интерфейса взаимодействия с удаленным веб-севрисом и т.д.)

Контроллеры — это модули, которые содержат основную логику приложения и логику связывания компонентов приложения. Контроллеры обращаются к API моделей, используют их в своих алгоритмах и передают в представления. С другой стороны, пользователь вводит даные в представлениях, которые обрабатываются контроллерами и помещаются в модели

**Зачем используется паттерн MVC?**

- Для разделения логики и соблюдения модульности
- Для обеспечения масштабируемости
- Для разработки несколькими программистами, в том числе одновременно

### 4 Создание модели шуток

В каталоге **Models** создадим новую модель (класс C#), который будет представлять шутку. Шутка имеет следующую структуру:

- ID
- Вопрос шутки (у нас все шутки будут в форме вопроса)
- Ответ

Назовем модель `Joke`:

```csharp
namespace JokesExampleWebApp.Models;  
  
public class Joke {  
      
    public int Id { get; set; }  
    public string Question { get; set; }  
    public string Answer { get; set; }  
}
```

### 5 Создание контроллера

Для нашей модели создадим контроллер. Согласно модели MVC, одному контроллеру соответствует одна модель

**В IDE Rider:**

- ПКМ на каталог `Controllers > Add > Scaffolded item...`
- `MVC Controller with views, using Entity Framework`
- Назовите контроллер `JokesController`
- Выберите модель для контроллера`Model class -> Jokes`
- Задайте контекст базы данных (выберите класс `ApplicationDbContext.cs`)
- Generate views (сгенерировать представления) -> да
- Reference script libraries (создать ссылки на библиотеки) -> да
- Use a layout page (использовать макет страницы) -> да
- Нажать `Add`

**В IDE Visual Studio:**

- ПКМ на каталог `Controllers > Add > Controller...` (`Контроллеры > Добавить > Контроллер...`)
- `MVC Controller with views, using Entity Framework`
- Выберите модель для контроллера`Model class -> Jokes`
- Задайте контекст базы данных (выберите класс `ApplicationDbContext.cs`)
- Generate views (сгенерировать представления) -> да
- Reference script libraries (создать ссылки на библиотеки) -> да
- Use a layout page (использовать макет страницы) -> да
- Нажать `Add`
  
После выполнения этих действий, будет начат процесс подгрузки нужных зависимостей

Будут сгенерированы представления с 4 операциями (`Views/Jokes`):

- `Create.cshtml` — создание
- `Delete.cshtml` — удаление
- `Details.cshtml` — подробности
- `Edit.cshtml` — редактирование
- `Index.cshtml` — основное представление для `Joke`

### 6 Запуск новосозданного представления

Теперь нам доступна новая страница `Jokes`. Запустим приложение. В строке поиска браузера указан текущий URL примерно такого содержания: `http://localhost:5299/`

Чтобы попасть на новую страницу, нужно к URL добавить ее название, которое совпадает с названием каталога `Views/Jokes`.

```url
http://localhost:5299/Jokes
```

Так как мы еще не настроили БД, мы получаем ошибку


<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Internal Server Error</title>
    <style>
            body {
    font-family: 'Segoe UI', Tahoma, Arial, Helvetica, sans-serif;
    font-size: .813em;
    line-height: 1.4em;
    color: #222;
}

h1, h2, h3, h4, h5 {
    font-weight: 100;
}

h1 {
    color: #44525e;
    margin: 15px 0 15px 0;
}

h2 {
    margin: 10px 5px 0 0;
}

h3 {
    color: #363636;
    margin: 5px 5px 0 0;
}

code {
    font-family: Consolas, "Courier New", courier, monospace;
}

a {
    color: #1ba1e2;
    text-decoration: none;
}

    a:hover {
        color: #13709e;
        text-decoration: underline;
    }

hr {
    border: 1px #ddd solid;
}

body .titleerror {
    padding: 3px;
}

#applyMigrations {
    font-size: 14px;
    background: #44c5f2;
    color: #ffffff;
    display: inline-block;
    padding: 6px 12px;
    margin-bottom: 0;
    font-weight: normal;
    text-align: center;
    white-space: nowrap;
    vertical-align: middle;
    cursor: pointer;
    border: 1px solid transparent;
}

    #applyMigrations:disabled {
        background-color: #a9e4f9;
        border-color: #44c5f2;
    }

.error {
    color: red;
}

.expanded {
    display: block;
}

.collapsed {
    display: none;
}

    </style>
</head>
<body>
    <h1>A database operation failed while processing the request.</h1>
    <p>
            <span>SqliteException: SQLite Error 1: &#x27;no such table: Joke&#x27;.</span>
            <br />
    </p>
    <hr />

            <div>
                <h2>There are pending model changes</h2>
                <p>Pending model changes are detected in the following:</p>
                <ul>
                        <li>ApplicationDbContext</li>
                </ul>
                <p>In Visual Studio, use the Package Manager Console to scaffold a new migration for these changes and apply them to the database:</p>
                <code>PM&gt; Add-Migration [migration name]</code>
                <br />
                <code>PM&gt; Update-Database</code>
                <p>Alternatively, you can scaffold a new migration and apply it from a command prompt at your project directory:</p>
                <code>&gt; dotnet ef migrations add [migration name]</code>
                <br />
                <code>&gt; dotnet ef database update</code>
                <hr />
            </div>
</body>
</html>

#Web #Dotnet/ASP-NET #Практика
