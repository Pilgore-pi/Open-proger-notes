Назад: [[07 _Встроенные делегаты|Встроенные делегаты]]

Событие — это факт совершившегося действия или изменения состояния объекта. При возникновении события, все объекты, отслеживающие это событие, могут в момент его возникновения выполнять различные операции. Эти операции можно задавать с помощью сторонних объектов, не имеющим понятия о внутренней реализации объекта, вызвавшего событие.

С точки зрения .Net, событие — это именованный делегат, при вызове которого, будут запущены все методы, подписавшиеся на событие. Другими словами — это публичный член класса, который позволяет снаружи класса узнать, что внутри класса что-то случилось.

```cs
// Событие как поле
[<modifier>] event <Delegate> MyEvent;

// Событие как свойство
[<modifier>] event <Delegate> MyEvent { add; remove; }
[<modifier>] event <Delegate> MyEvent { add => ...; remove => ...; }
[<modifier>] event <Delegate> MyEvent
{
    add { ... }
    remove { ... }
}
```

```csharp
event Action EverythingExploded;
```

События могут содержаться в:

- структурах
- классах
- интерфейсах

> **Обработчик события (Event handler)** — это метод, соответствующий типу делегата события, который вызывается при происшествии события.

Событие могут обрабатывать несколько обработчиков события, благодаря тому, что событие основано на делегате, который может хранить набор ссылок на методы

Тип, в котором определяется событие (класс, структура, интерфейс), обладает полным доступом над событием. Он может вызывать событие, когда угодно. Снаружи типа можно выполнить только 2 действия:

1) Подписка на событие (`add`, `myEvent += EventHandler`)
2) ~~Дизлайк~~ Отписка от события (`remove`, `meEvent -= EventHandler`)

Есть 3 способа непосредственного запуска события из определяющего типа:

1) `MyEvent(...)` — вызов события в стиле синтаксиса делегата
2) `MyEvent.Invoke(...)` — вызов события, не допускающего `null`
3) `MyEvent?.Invoke(...)` — вызывает событие, допускающее `null`, или, если событие не содержит ссылок на обработчики, то возвращается `null`

Для событий определен специальный синтаксис, похожий на синтаксис свойств. Также имеется 2 метода, инкапсулирующих доступ к подписке и отписки от события. Эти методы называются `add_MyEvent` и `remove_MyEvent`. К ним можно обратиться следующим образом:

```csharp
delegate void AccountHandler(string message);
private event AccountHandler _notify;
public event AccountHandler Notify
{
	add
	{
		_notify += value;
		...
	}
	remove
	{
		_notify –= value;
		...
	}
}
```

## Отличия делегата и события

1. Делегат можно вызвать где угодно, поэтому нельзя его использовать как событие, так как кто угодно сможет его вызвать.
2. Событие содержит приватное поле-делегат со ссылками на все обработчики событий
3. Событие содержит 2 метода подписки и отписки от события.
4. Событие, не может быть локальной переменной в методе
5. Событие может быть полем или свойством со специальными аксессорами `add` и `remove`

В .NET существует установленный стандарт формы обработчиков событий:

```csharp
void Handler(object? sender, EventArgs e) {...}
```

`EventArgs` — базовый класс для всех классов, предназначенных для передачи информации событий.

#C-Sharp #C-Sharp/Functions/Delegates