https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/preprocessor-directives

**Директивы препроцессора** — это команды, обрабатываемые **до** компиляции программы

В C# директивы препроцессора более ограничены по сравнению с C/C++:

- ❌ Создание макросов недоступно
- ❌ Текстовая подстановка не поддерживается
- ⚠️ На одной строке может находиться только одна директива препроцессора и ничего более
- ✅ Директивы начинаются с символа `#`
- ✅ Директива должна быть первым непробельным символом в строке

## Директива `#nullable`

Управляет контекстом nullable-ссылочных типов (доступно с C# 8.0)

### Основные значения

- **`enable`**: включает nullable-контекст (все ссылочные типы по умолчанию non-nullable)
- **`disable`**: отключает nullable-контекст (поведение как в старых версиях C#)
- **`restore`**: сброс настроек nullable-контекста до настроек, определенных на уровне проекта

### Детальные значения

- **`enable annotations`**: включает nullable-аннотации (позволяет использовать `?` для ссылочных типов)
- **`disable annotations`**: отключает nullable-аннотации
- **`restore annotations`**: восстанавливает настройки аннотаций из проекта

- **`enable warnings`**: включает предупреждения компилятора о nullable
- **`disable warnings`**: отключает предупреждения компилятора о nullable
- **`restore warnings`**: восстанавливает настройки предупреждений из проекта

```csharp
#nullable enable
string s1 = null; // Предупреждение
string? s2 = null; // OK

#nullable disable
string s3 = null; // Без предупреждения

#nullable restore
```

## Условная компиляция

Позволяет включать или исключать части кода в зависимости от определенных символов

### Синтаксис

```csharp
#if символ
    // код компилируется, если символ определен
#elif другой_символ
    // код компилируется, если другой_символ определен
#else
    // код компилируется, если ни один символ не определен
#endif
```

### Операторы препроцессора

| Оператор | Описание                                                 |
|:---------|:---------------------------------------------------------|
| `==`     | Проверка равенства (сравнение символов)                  |
| `!=`     | Проверка неравенства                                     |
| `&&`     | Логическое И (оба условия должны быть истинными)         |
| \|\|     | Логическое ИЛИ (хотя бы одно условие должно быть истинным)|
| `!`      | Логическое НЕ (отрицание)                                |
| `(`, `)` | Допустимо использование скобок для группировки выражений |

### Примеры

```csharp
#if DEBUG
    Console.WriteLine("Режим отладки");
#elif RELEASE
    Console.WriteLine("Режим релиза");
#else
    Console.WriteLine("Неизвестный режим");
#endif

#if DEBUG && TRACE
    Console.WriteLine("Отладка с трассировкой");
#endif

#if !(NET5_0 || NET6_0)
    // Код для версий, отличных от .NET 5.0 и 6.0
#endif
```

## Символы препроцессора

### Директива `#define`

Определяет символ препроцессора

```csharp
#define SYMBOL_NAME
```

**Важно:**

- Должна быть размещена **до любого кода** (даже до `using`)
- Действует только в пределах текущего файла
- Не может переопределить символ

```csharp
#define DEBUG
#define TRACE
#define VERSION2

using System;

#if DEBUG
    // код
#endif
```

### Директива `#undef`

Отменяет определение символа

```csharp
#undef SYMBOL_NAME
```

```csharp
#define DEBUG
#undef DEBUG  // Теперь DEBUG не определен

#if DEBUG
    // Этот код НЕ будет скомпилирован
#endif
```

### Предопределенные символы

C# автоматически определяет некоторые символы:

| Символ | Описание |
|:-------|:---------|
| `DEBUG` | Определен в конфигурации Debug |
| `TRACE` | Определен в конфигурациях Debug и Release (по умолчанию) |
| `NET5_0`, `NET6_0`, `NET7_0`, и т.д. | Целевая версия .NET |
| `NETFRAMEWORK`, `NETSTANDARD`, `NETCOREAPP` | Целевая платформа |

## Директивы диагностики

### Директива `#warning`

Генерирует предупреждение компилятора уровня 1

```csharp
#warning Это сообщение-предупреждение
```

```csharp
#if DEBUG
    #warning Приложение компилируется в режиме отладки
#endif
```

### Директива `#error`

Генерирует ошибку компилятора

```csharp
#error Это сообщение об ошибке
```

```csharp
#if UNSUPPORTED_PLATFORM
    #error Эта платформа не поддерживается
#endif
```

## Директивы управления регионами

### Директива `#region` / `#endregion`

Позволяет создавать сворачиваемые блоки кода в IDE

```csharp
#region Название региона
    // код
#endregion
```

```csharp
#region Поля класса

private int id;
private string name;

#endregion

#region Конструкторы

public MyClass() { }
public MyClass(int id) { this.id = id; }

#endregion
```

**Примечание:** Не влияет на компиляцию, используется только для организации кода

## Директива `#line`

Изменяет номера строк и имя файла в сообщениях компилятора и отладчике.

### Синтаксис

```csharp
#line номер_строки
#line номер_строки "имя_файла"
#line default  // восстановить нумерацию
#line hidden   // скрыть от отладчика
```

### Примеры

```csharp
#line 100
Console.WriteLine("Эта строка будет считаться строкой 100");

#line 200 "CustomFile.cs"
Console.WriteLine("Строка 200 из CustomFile.cs");

#line default
Console.WriteLine("Нормальная нумерация восстановлена");

#line hidden
// Этот код будет пропущен отладчиком
#line default
```

**Применение:** Используется генераторами кода для сопоставления сгенерированного кода с исходным.

## Директива `#pragma`

Предоставляет специальные инструкции компилятору

### `#pragma warning`

Управляет предупреждениями компилятора

```csharp
#pragma warning disable код_предупреждения
#pragma warning restore код_предупреждения
```

```csharp
// Отключить предупреждение CS0168 (переменная объявлена, но не используется)
#pragma warning disable CS0168
int unusedVariable;
#pragma warning restore CS0168

// Отключить несколько предупреждений
#pragma warning disable CS0168, CS0219
int x;
int y = 5;
#pragma warning restore CS0168, CS0219

// Отключить все предупреждения
#pragma warning disable
// код
#pragma warning restore
```

### `#pragma checksum`

Генерирует контрольные суммы для отладки ASP.NET.

```csharp
#pragma checksum "file.cs" "{GUID}" "контрольная_сумма"
```

## Практические примеры

### Пример 1: Условная компиляция для разных платформ

```csharp
#define WINDOWS

using System;

class Program {
    static void Main() {
        #if WINDOWS
            Console.WriteLine("Версия для Windows");
            // Windows-специфичный код
        #elif LINUX
            Console.WriteLine("Версия для Linux");
            // Linux-специфичный код
        #elif MACOS
            Console.WriteLine("Версия для macOS");
            // macOS-специфичный код
        #else
            #error Неподдерживаемая платформа
        #endif
    }
}
```

### Пример 2: Отладочная информация

```csharp
using System;
using System.Diagnostics;

class Program {
    static void Main() {
        DoWork();
    }
    
    [Conditional("DEBUG")]
    static void DebugLog(string message) {
        Console.WriteLine($"[DEBUG] {message}");
    }
    
    static void DoWork() {
        DebugLog("Начало работы");
        
        #if DEBUG
            Console.WriteLine("Режим отладки активен");
        #endif
        
        // основной код
        
        DebugLog("Конец работы");
    }
}
```

### Пример 3: Версионирование

```csharp
#define VERSION_2

using System;

class Program {
    static void Main() {
        #if VERSION_1
            Console.WriteLine("Версия 1.0");
        #elif VERSION_2
            Console.WriteLine("Версия 2.0");
            // Новая функциональность
        #else
            #warning Версия не определена
        #endif
    }
}
```

## Таблица всех директив

| Директива | Описание |
|:----------|:---------|
| `#if` | Начало условной компиляции |
| `#elif` | Альтернативное условие |
| `#else` | Альтернативная ветка |
| `#endif` | Конец условной компиляции |
| `#define` | Определяет символ |
| `#undef` | Отменяет определение символа |
| `#warning` | Генерирует предупреждение |
| `#error` | Генерирует ошибку |
| `#region` | Начало сворачиваемого региона |
| `#endregion` | Конец региона |
| `#line` | Изменяет информацию о строке |
| `#pragma` | Специальные инструкции компилятору |
| `#nullable` | Управляет nullable-контекстом |

## Лучшие практики

✅ **Рекомендуется:**

- Использовать условную компиляцию для платформо-зависимого кода
- Применять `#region` для организации больших классов
- Использовать `#pragma warning disable` локально и всегда восстанавливать
- Определять символы через настройки проекта, а не `#define`

❌ **Не рекомендуется:**

- Злоупотреблять условной компиляцией (усложняет чтение кода)
- Использовать `#region` для сокрытия плохо организованного кода
- Глобально отключать предупреждения
- Использовать `#define` для конфигурационных значений (лучше использовать константы)

#GENERATED
