В 70-е годы 20 века были распространены большие обособленные сети компьютеров. Каждая такая сеть имела свои особенности отправки и приема сообщений, а также свои форматы сообщений. Со временем, для обеспечения возможности взаимодействия всех сетей между собой была разработана **модель организации сети OSI**

## Модель OSI

Модель OSI состоит из следующих уровней:

1) Прикладной — самый высокий уровень, уровень прикладных программ, с которыми работают пользователи. В качестве прикладных программам могут выступать: браузер, почтовый клиент, FTP клиент и т. д.
2) Представления — определяет, как должно быть представлено сообщение, в какой кодировке и с какими параметрами шифрования
3) Сеансовый — контролирует очередность пакетов данных, синхронизирует потоки (например звук и видео), обрабатывает возможные разрывы связи
4) Транспортный
5) Сетевой
6) Канальный
7) Физический — провода


Механизм отправки и получения по модели OSI

- ***Отправитель*** формирует сообщение на прикладном уровне и последовательно проходит по всем уровням вплоть до физического. На каждом уровне формируется заголовок сообщения (метаданные)

- ***Получатель*** принимает сообщение на физическом уровне и последовательно проходит все уровни модели, читая заголовки сообщения. В итоге прикладное приложение, для которого предназначено сообщение получает его содержимое

Можно сказать, что отправка и получение работают по принципу матрешки. На каждом уровне сообщение помещается в новый слой (добавляется заголовок слоя). Получатель затем разворачивает все слои

## Модель TCP / IP

Модель TCP / IP является модификацией модели OSI. TCP / IP объединяет несколько уровней OSI и дополнительно определяет, какие протоколы связи должны использоваться на каждом уровне

> Протокол связи — 

Уровни модели TCP / IP:

1) Прикладной — объединяет следующие OSI уровни:
    1) прикладной
    2) представления
    3) сеансовый
    Данные на этом уровне именуются "сообщением". Так как функции прикладного уровня, уровня представления и сеансогого могут обрабатываться одной прикладной программой, эти уровни OSI обеденены в один прикладной уровень в TCP / IP.
    На этом уровне создается заголовок сообщения (служебная информация), которая зависит от используемого протокола (HTTP, SMTP, FTP и др.)

2) Транспортный — протоколы TCP (самый популярный), UDP, SCTP, DCCP и т. д. Данный уровень описывает, как и куда (какому процессу) должно прийти сообщение. Существует специальная система адресации сетевых сообщений (система портов). Порт — это двухбайтовое неотрицательное число, представляющее адрес ресурса в сети, который может принимать или отправлять сообщения
    1) Потры `1 - 1024` — общепринятые. Используются прикладными приложениями. По умолчанию порт *80 использутся для HTTP*; *443 для HTTPS*, *53 для DNS*
    2) Порты `1025 - 49151` — зарезервированные порты организацией IANA
    3) Порты `49152 - 65535` — для любых целей. ОС автоматически генерирует порты для сетевых программ в этом диапазоне

3) Межсетевой — протокол IP (самый популярный), ARP, ICMP, IGMP, IPsec, GRE и т. д.

4) Канальный — объединяет следующие OSI уровни:
    1) Канальный
    2) Физический
    Канальный и физический уровни выполняют достаточно разные задачи и, в некоторых источниках, модель TCP / IP разделяют не на 4, а на 5 уровней с отдельными канальным и физическим уровнями

Название модели TCP / IP формируется из назнваний самым популярных протоколов TCP и IP

### Описание транспортного уровня

Цель траспортного уровня заключается в обеспечении механизма передачи данных с одного порта на другой

#### Механизм работы протокола TCP

1) Сообщение делится на сегменты

2) Для каждого сегмента формируется заголовок TCP. При этом сегменты не синхронизированы. Один сегмент может прийти раньше другого или вообще потеряться в следствии, например, плохого соединения

3) В процессе приема сообщения при получении каждого сегмента сообщения получатель отправляет подтверждение того, что получатель принял сегмент. Отправитель при этом запускает таймер ожидания подтверждения, по истечении которого заново отправляет сегмент данных. Получатель может получить сообщение, но отправитель не получить подтверждение. В таком случае отправитель заново отправляет сообщение, а получатель отбрасывает его, анализируя порядковый номер сегмента (определенный в заголовке) и заново отправляет подтверждение отправителю

Структура заголовка TCP:

| Поле                         | Размер в битах | Описание                                                                                                                                                                                                                                                                             |
| ---------------------------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Порт отправителя             | 16             |                                                                                                                                                                                                                                                                                      |
| Порт получателя              | 16             |                                                                                                                                                                                                                                                                                      |
| Порядковый номер             | 32             | Номер первого байта текущего сегмента сообщения. Эта информация нужна для последующей синхронизации всех сегментов и формирования сообщения на стороне получателя                                                                                                                    |
| Номер подтверждения          | 32             | Номер следующего ожидаемого байта сообщения                                                                                                                                                                                                                                          |
| Длина заголовка              | 4              |                                                                                                                                                                                                                                                                                      |
| 3 выравнивающих нулевых бита | 3              |                                                                                                                                                                                                                                                                                      |
| Флаг `NS`                    | 1              | Служит для предотвращения случайного изменения или неизменения флагов `CWR` и `ECE`                                                                                                                                                                                                  |
| Флаг `CWR`                   | 1              | Флаг подтверждения о перегрузке сети от отправителя (см. флаг `ECE`)                                                                                                                                                                                                                 |
| Флаг `ECE`                   | 1              | Флаг подтверждения о перегрузке сети от получателя. Маршрутизатор при перегрузке может отправить получателю сегмент с измененным заголовком IP, тогда получатель в сегменте-подтвеждении устанавливает флаг `ECE`. В ответ отправитель также отправляет подтверждение с флагом `CWR` |
| Флаг `UGR`                   | 1              | Определеяет, содержит ли сегмент срочные данные, необходимые программе                                                                                                                                                                                                               |
| Флаг `ACK`                   | 1              | Ставится при получении сегмента получателем. Отправитель анализирует флаг и определяет, нужно ли считывать данные по **номеру подтвеждения** или нет                                                                                                                                 |
| Флаг `PSH`                   | 1              | Указывает на то, что сегмент нужно передавать программе сразу без внесения в промежуточный буфер                                                                                                                                                                                     |
| Флаг `RST`                   | 1              | Флаг, который говорит о критической ошибке. Отправитель сегмента с данным флагом не ожидает ответа и экстренно разрывает соединение. Получатель также разрывает соединение без отправки подтверждения                                                                                |
| Флаг `SYN`                   | 1              | Определяет создано ли предварительное соединение для передачи сообщения по протоколу TCP                                                                                                                                                                                             |
| Флаг `FIN`                   | 1              | Указывает на то, что у передающей стороны больше нет данных для передачи. При попытке разрыва соединения отправитель и получатель отправляют сегмент с флагом `FIN` и в ответ ожидают  подтверждение с флагом `ACK`                                                                  |
| Размер окна (буфера)         | 16             | Определяет размер буфера сегментов                                                                                                                                                                                                                                                   |
| Констрольная сумма           | 16             | Хэш-значение, вычисляемое на основе заголовка и содержимого всего сообщения                                                                                                                                                                                                          |
| Указатель на срочные данные  | 16             |                                                                                                                                                                                                                                                                                      |
| (Необязательные параметры)   | ?              | Часть заголовка с неизвестной длиной. Информация о размере заголовка храниться в поле "Длина заголовка"                                                                                                                                                                              |

#### Механизм работы UDP протокола

В отличие от TCP протокола, UDP:

- Не контролирует целостность передаваемых данных
- Не создает предварительного подключения
- Не анализирует перегрузку сети
- Не ожидает подтверждения о получении сегментов
- Не занимается управлением размера окна
- Гораздо быстрее
- Заголовок UDP занимает всего 8 байт

Структура заголовка UDP:

| Поле                             | Размер в битах | Описание       |
| -------------------------------- | -------------- | -------------- |
| Порт отправителя                 | 16             | необязательное |
| Порт получателя                  | 16             |                |
| Длина заголовка вместе с данными | 16             |                |
| Контрольная сумма                | 16             | необязательное |

### Описание межсетевого уровня

Цель межсетевого уровня — обеспечить передачу данных с одного устройства на другое.

Каждое устройство в сети имеет идентификатор, называемый IP-адресом

#### Механизм работы протокола IPv4

Согласно протоколу, сформированные на предыдущем этапе сегменты с заголовками TCP, UDP или др. дополняются IP-заголовком. После этой операции сегмент становится *пакетом*

Структура заголовка IPv4:

| Поле                   | Размер в битах | Описание                                                                                                                                                                                                                  |
| ---------------------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Номер версии IP адреса | 4              | Значение для IPv4: `4`                                                                                                                                                                                                    |
| Длина заголовка        | 4              |                                                                                                                                                                                                                           |
| Тип обслуживания       | 8              | Набор битовых флагов, который определяет параметры обслуживания пакета                                                                                                                                                    |
| Общая длина            | 16             | Размер пакета в байтах                                                                                                                                                                                                    |
| ID пакета              | 16             | Идентификатор фрагмента IP пакета. Пакеты данных могут разбиваться на фрагменты, если на **канальном уровне** есть ограничения на размер пакета, которое не соблюдается                                                   |
| Зарезервированный флаг | 1              | Не используется                                                                                                                                                                                                           |
| Флаг `DF`              | 1              | `1`: фрагментация запрещена                                                                                                                                                                                               |
| Флаг `MF`              | 1              | `1`: это не последний фрагмент пакета; `0`: это последний фрагмент                                                                                                                                                        |
| Смещение фрагмента     | 13             | Если смещение фрагмента И флаг `MF` установлены в 0, то текущий пакет данных считается полноценным пакетом, а не фрагментом                                                                                               |
| Время жизни            | 8              | Определяет, сколько раз пакет может быть передан с одного устройства на другое. При получении пакета данных текущее устройство уменьшает значение этого параметра на 1. Предназначен для ошищения зависших пакетов данных |
| Тип протокола          | 8              | Число, указывающее на тип используемого транспортного протокола                                                                                                                                                           |
| Контрольная сумма      | 16             | Рассчитывается на каждом маршрутизаторе в цепочке сетевого соединения, так как заголовок может меняться                                                                                                                   |
| IPv4 отправителя       | 32             |                                                                                                                                                                                                                           |
| IPv4 получателя        | 32             |                                                                                                                                                                                                                           |
| (Необязательные поля)  |                |                                                                                                                                                                                                                           |

Если на межсетевом уровне возникает ошибка, то маршрутизатор формирует пакет с **ICMP** сообщением о отправляет обратно отправителю

Структура заголовка ICMP сообщения:

| Поле              | Размер в битах | Описание                                       |
| ----------------- | -------------- | ---------------------------------------------- |
| Тип сообщения     | 8              | содержит идентификатор ошибки                  |
| Код сообщения     | 8              | содержит идентификатор более конкретной ошибки |
| Контрольная сумма | 16             |                                                |
| Служебные данные  | 32             |                                                |

#### Механизм работы протокола IPv6

| Поле                    | Размер в битах | Описание                                                                                                                                            |
| ----------------------- | -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| Номер версии            | 4              | Значение для IPv6: `6`                                                                                                                              |
| Класс трафика           | 8              | Аналог поля "Тип обслуживания"                                                                                                                      |
| Метка потока            | 16             | Идентификатор, позволяющий маршрутизатору кэшировать заголовки и не далать их анализ заново, если метка потока совпадает с той, что уже есть в кэше |
| Длина полезной нагрузки | 16             | Длина данных                                                                                                                                        |
| Следующий заголовок     |                | Аналог поля IPv4 "Тип протокола"                                                                                                                    |
| Число переходов         | 8              | Аналог поля "Время жизни"                                                                                                                           |
| IPv4 отправителя        | 128            |                                                                                                                                                     |
| IPv4 получателя         | 128            |                                                                                                                                                     |

### Описание канального уровня

Каждая подсеть образует канальную среду, в которой есть устройство, называемое коммутатором, который подключается к провайдеру и к которому подключаются конечные сетевые устройства

Каждое сетевое устройство имеет MAC-адрес

Основными технологиями канального уровня являются:

1) **Ehternet**
2) **Wi-Fi**

#### Ethernet

В процессе развития интернета развивалась и технология Ethernet, которая имеет множество версий. Основные из них перечислены ниже:

| Версия Ethernet  | Пропускная способность |
| ---------------- | ---------------------- |
| Ethernet         | 10 Мбит/с              |
| Fast Ethernet    | 100 Мбит/с             |
| Gigabit Ethernet | 1 Гбит/с               |
| 5G Ethernet      | 5 Гбит/с               |
| 10G Ethernet     | 10 Гбит/с              |
| 100G Ethernet    | 100 Гбит/с             |

> Пакет, который пришел на канальный уровень с сетевого называется ***кадром***

Структура кадра:

| Поле                   | Размер в битах     | Описание               |
| ---------------------- | ------------------ | ---------------------- |
| MAC-адрес получателя   | 48                 | Значение для IPv6: `6` |
| MAC-адрес отправителя  | 48                 |                        |
| Тип сетевого протокола | 16                 | (`0800` - IPv4)        |
| (Данные)               | от 46 до 1500 байт |                        |
| Контрольная сумма      | 32                 |                        |

Чтобы понять, где начинается и заканчивается кадр, к каждому кадру в начале добавляется 8 байт. Первых 7 из них одинаковые, а последний 8-й оканчивается на две единицы, означая начало кадра

### Физический уровень

На этом уровне не определяются никакие заголовки. Все данные представлены потоком битов, существующих в среде передачи данных. Средой передачи могут, например, быть кабель или радиоэфир

Виды каб

Источники:

1) [AlekOS (YouTube)](https://www.youtube.com/watch?v=EJzitviiv2c)
2) Perplexity

#Network